<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Editor with Multi-Language Support</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.0.0/dist/transformers.min.js';
        env.allowLocalModels = false;
        env.remoteHost = 'https://huggingface.co';
        window.transformers = { pipeline, env };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Karla:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&family=IBM Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <link href="https://db.onlinewebfonts.com/c/5aed06c88c643ae6f0d4d1027893350c?family=Elianto" rel="stylesheet">
    <style>
        .monaco-editor-container { height: 400px; border: 1px solid #374151; border-radius: 8px; }
        .chat-message { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-bg { background: black; }
        .hero-text { font-family: 'Cormorant Garamond', serif; color: white; }
        .features-section { font-family: 'Karla', sans-serif; }
        .features-title { font-family: 'Spectral', serif; }
        .ai-chat-section { font-family: 'IBM Plex Mono', monospace; }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); }
        .code-output { background: #1a1a1a; color: #00ff00; font-family: 'Courier New', monospace; white-space: pre-wrap; }
        .typing-indicator { display: none; }
        .typing-indicator.active { display: inline-block; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .feature-card { 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 1px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        .feature-card:hover::before {
            left: 100%;
        }
        .feature-card:hover { 
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), 0 8px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            40% { color: #00ff00; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); }
            60% { text-shadow: .25em 0 0 #00ff00, .5em 0 0 rgba(0,0,0,0); }
            80%, 100% { text-shadow: .25em 0 0 #00ff00, .5em 0 0 #00ff00; }
        }
        
        .nav-link {
            position: relative;
            color: #fecaca;
            padding: 0.5rem 1rem;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }
        .nav-link:hover {
            color: #ffffff;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #ffffff;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        .nav-link:hover::after {
            width: 80%;
        }
        .nav-link i {
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }
        
        .sample-code-btn {
            width: 100%;
            text-align: left;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid rgba(107, 114, 128, 0.3);
            border-radius: 0.375rem;
            color: #e5e7eb;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sample-code-btn:hover {
            background: rgba(75, 85, 99, 0.8);
            border-color: rgba(156, 163, 175, 0.5);
            color: #ffffff;
            transform: translateX(4px);
        }
        .sample-code-btn i {
            font-size: 0.75rem;
            color: #9ca3af;
        }
        .brand-text { 
            font-family: 'Elianto', sans-serif; 
            font-weight: normal; 
        }
        
        .hero-bg {
            position: relative;
            overflow: hidden;
        }
        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.5;
        }
        .floating-code {
            position: absolute;
            color: rgba(255, 255, 255, 0.1);
            font-size: 2rem;
            animation: float 20s infinite linear;
            pointer-events: none;
            z-index: 1;
        }
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }
        .code-mockup {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            font-family: 'IBM Plex Mono', monospace;
        }
        .code-header {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .code-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .code-content {
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: #fff;
            animation: blink 1s infinite;
            margin-left: 2px;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .keyword { color: #ff79c6; }
        .function { color: #50fa7b; }
        .string { color: #f1fa8c; }
        .comment { color: #6272a4; }
        .tagline {
            display: inline-block;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            letter-spacing: 1px;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
        }
        
        /* Hero section optimization for desktop */
        @media (min-width: 768px) {
            .hero-section-optimized {
                min-height: auto !important;
                padding-top: 3rem;
                padding-bottom: 3rem;
            }
            .hero-content-wrapper {
                padding-top: 2rem;
                padding-bottom: 2rem;
            }
            .hero-section-optimized h1 {
                margin-bottom: 1rem !important;
                font-size: 3rem !important;
                line-height: 1.1;
            }
            .hero-section-optimized .text-xl {
                font-size: 1.125rem !important;
                margin-bottom: 0.75rem !important;
            }
            .hero-section-optimized .text-lg {
                margin-bottom: 1.5rem !important;
            }
            .hero-section-optimized .tagline {
                margin-bottom: 1rem !important;
                font-size: 0.85rem !important;
                padding: 0.4rem 1.2rem !important;
            }
            .hero-section-optimized .mt-6 {
                margin-top: 1rem !important;
            }
        }
        
        /* Tablet adjustments */
        @media (min-width: 1024px) {
            .hero-section-optimized h1 {
                font-size: 3.5rem !important;
            }
        }
        
        /* Mobile - keep full height for better aesthetics */
        @media (max-width: 767px) {
            .hero-section-optimized {
                min-height: 100vh;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Navigation -->
    <nav class="shadow-lg sticky top-0 z-50" style="background: #b91c1c;">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <h1 class="text-2xl font-bold text-white brand-text"><span style="font-size: 1.8rem;">🤝💯</span> Help Genie</h1>
                </div>
                <div class="flex space-x-2">
                    <a onclick="showSection('landing')" class="nav-link cursor-pointer">
                        <i class="fas fa-home"></i>Home
                    </a>
                    <a onclick="showSection('editor')" class="nav-link cursor-pointer">
                        <i class="fas fa-code"></i>Code Editor
                    </a>
                    <a onclick="showSection('chat')" class="nav-link cursor-pointer">
                        <i class="fas fa-comments"></i>AI Chat
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Landing Page Section -->
    <section id="landing">
        <!-- Hero Section -->
        <div class="hero-section-optimized flex items-center justify-center hero-bg" style="background: #b91c1c;">
            <!-- Floating Code Elements -->
            <div class="floating-code" style="top: 10%; left: 10%;">&lt;/&gt;</div>
            <div class="floating-code" style="top: 20%; right: 15%; animation-delay: -5s;">{ }</div>
            <div class="floating-code" style="bottom: 15%; left: 20%; animation-delay: -10s;">[ ]</div>
            <div class="floating-code" style="top: 60%; right: 10%; animation-delay: -7s;">( )</div>
            <div class="floating-code" style="bottom: 30%; right: 25%; animation-delay: -3s;">=&gt;</div>
            
            <div class="container mx-auto px-4 hero-content-wrapper" style="position: relative; z-index: 10;">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center max-w-7xl mx-auto">
                    <!-- Left Content -->
                    <div class="text-center md:text-left" style="position: relative; z-index: 10;">
                        <div class="tagline text-white">
                            🚀 THE AI-POWERED CODE EDITOR
                        </div>
                        <h1 class="text-5xl lg:text-6xl font-bold mb-6 hero-text">
                            Build Apps with AI
                        </h1>
                        <p class="text-xl hero-text mb-4">
                            Transform your ideas into working applications using natural language
                        </p>
                        <p class="text-lg hero-text mb-8 opacity-90">
                            Get instant coding help, explanations, and code suggestions with our AI-powered coding assistant.
                        </p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                            <button onclick="showSection('editor')" class="px-8 py-4 bg-white text-red-700 rounded-lg font-semibold text-lg hover:bg-gray-100 transition-colors shadow-lg">
                                <i class="fas fa-rocket mr-2"></i>Start Coding
                            </button>
                            <button onclick="showSection('chat')" class="px-8 py-4 border-2 border-white text-white rounded-lg font-semibold text-lg hover:bg-white hover:text-red-700 transition-colors">
                                <i class="fas fa-comments mr-2"></i>Try AI Chat
                            </button>
                        </div>
                        <div class="mt-6 text-sm text-white opacity-75">
                            <i class="fas fa-check-circle mr-2"></i>21 Languages • AI-Powered • Free to Use
                        </div>
                        
                        <!-- Programming Language Badges -->
                        <div class="mt-6 flex flex-wrap gap-2 justify-center md:justify-start">
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🐍 Python
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                ⚡ JavaScript
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                ☕ Java
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                ⚙️ C++
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🔷 TypeScript
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🦀 Rust
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🐹 Go
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                💎 Ruby
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🐘 PHP
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🍎 Swift
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🤖 Kotlin
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                💻 C#
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🎯 Scala
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🗄️ SQL
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                📊 R
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🌐 HTML
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🎨 CSS
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🐪 Perl
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                🌙 Lua
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                💻 Bash
                            </span>
                            <span class="px-3 py-1.5 text-xs font-semibold rounded-full bg-white bg-opacity-20 text-white backdrop-blur-sm border border-white border-opacity-30 hover:bg-opacity-30 transition-all">
                                ⚡ C
                            </span>
                        </div>
                    </div>
                    
                    <!-- Right Content - Interactive Code Mockup -->
                    <div class="code-mockup">
                        <div class="code-header">
                            <div class="code-dot" style="background: #ff5f56;"></div>
                            <div class="code-dot" style="background: #ffbd2e;"></div>
                            <div class="code-dot" style="background: #27c93f;"></div>
                            <div style="margin-left: auto;">
                                <span id="languageBadge" class="text-xs px-3 py-1 rounded-full" style="background: rgba(255,255,255,0.1);">JavaScript</span>
                            </div>
                        </div>
                        <div id="codePreview" class="code-content text-left" style="transition: opacity 0.5s;">
                            <!-- Code will be dynamically inserted here -->
                        </div>
                        <div class="mt-4 pt-4" style="border-top: 1px solid rgba(255,255,255,0.1);">
                            <div class="text-xs text-gray-400 mb-2">OUTPUT:</div>
                            <div id="codeOutputDemo" class="text-green-400 text-sm">✨ Perfect Code!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Powerful AI Development Features Section -->
        <div class="py-20 features-section" style="background: #b91c1c;">
            <div class="container mx-auto px-4">
                <h2 class="text-center text-4xl font-bold mb-12 features-title text-white">Powerful AI Development Features</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
                    <!-- AI Code Generation -->
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-8 feature-card">
                        <div class="text-purple-400 text-5xl mb-5">
                            <i class="fas fa-magic"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-white features-title">AI Code Generation</h3>
                        <p class="text-gray-300 text-base leading-relaxed">Get instant code suggestions and snippets with our AI-powered coding assistant. Describe your coding needs, and our AI generates relevant code suggestions to help you build faster and smarter.</p>
                    </div>

                    <!-- Multi-Language Support -->
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-8 feature-card">
                        <div class="text-blue-400 text-5xl mb-5">
                            <i class="fas fa-code"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-white features-title">Multi-Language Support</h3>
                        <p class="text-gray-300 text-base leading-relaxed">Support for 15+ programming languages including Python, JavaScript, Java, C++, Go, Rust, and many more.</p>
                    </div>

                    <!-- Intelligent Chat -->
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-8 feature-card">
                        <div class="text-green-400 text-5xl mb-5">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-white features-title">Intelligent Chat</h3>
                        <p class="text-gray-300 text-base leading-relaxed">Chat with AI to explain code, debug issues, and get coding help in real-time with contextual understanding.</p>
                    </div>

                    <!-- Project Management -->
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-8 feature-card">
                        <div class="text-yellow-400 text-5xl mb-5">
                            <i class="fas fa-folder"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-white features-title">Project Management</h3>
                        <p class="text-gray-300 text-base leading-relaxed">Organize your projects with file management, create folders, edit files, and maintain project structure.</p>
                    </div>

                    <!-- Code Execution -->
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-8 feature-card">
                        <div class="text-red-400 text-5xl mb-5">
                            <i class="fas fa-play"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-white features-title">Code Execution</h3>
                        <p class="text-gray-300 text-base leading-relaxed">Run and test your code directly in the browser with real-time output and error handling.</p>
                    </div>

                    <!-- Export Projects -->
                    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-8 feature-card">
                        <div class="text-cyan-400 text-5xl mb-5">
                            <i class="fas fa-download"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-white features-title">Export Projects</h3>
                        <p class="text-gray-300 text-base leading-relaxed">Download your complete projects as ZIP files with all files and dependencies included.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works Section -->
        <div class="py-20 features-section" style="background: #b91c1c;">
            <div class="container mx-auto px-4">
                <h2 class="text-center text-4xl font-bold mb-12 features-title text-white">How It Works</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                    <!-- Step 1 -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-6">1</div>
                        <h3 class="text-xl font-semibold mb-4 text-white features-title">Write Your Code</h3>
                        <p class="text-gray-300 leading-relaxed">Start coding in one of our 21 supported languages.</p>
                    </div>

                    <!-- Step 2 -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-6">2</div>
                        <h3 class="text-xl font-semibold mb-4 text-white features-title">Get AI Assistance</h3>
                        <p class="text-gray-300 leading-relaxed">Our AI-powered assistant provides instant coding help, explanations, and suggestions.</p>
                    </div>

                    <!-- Step 3 -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-6">3</div>
                        <h3 class="text-xl font-semibold mb-4 text-white features-title">Run and Test</h3>
                        <p class="text-gray-300 leading-relaxed">Run your code in our live environment to see real-time output.</p>
                    </div>

                    <!-- Step 4 -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-yellow-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-6">4</div>
                        <h3 class="text-xl font-semibold mb-4 text-white features-title">Debug and Optimize</h3>
                        <p class="text-gray-300 leading-relaxed">Use our AI-powered debugging tools to identify and fix errors.</p>
                    </div>

                    <!-- Step 5 -->
                    <div class="text-center">
                        <div class="w-16 h-16 bg-cyan-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-6">5</div>
                        <h3 class="text-xl font-semibold mb-4 text-white features-title">Export Your Project</h3>
                        <p class="text-gray-300 leading-relaxed">Export your project with all files and dependencies included.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-900 py-12 border-t border-gray-800">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
                    <!-- About Section -->
                    <div>
                        <div class="flex items-center space-x-2 mb-4">
                            <h3 class="text-xl font-bold text-white brand-text"><span style="font-size: 1.5rem;">🤝💯</span> Help Genie</h3>
                        </div>
                        <p class="text-gray-400 text-sm leading-relaxed">
                            Transform your ideas into working applications using natural language and AI-powered code generation.
                        </p>
                    </div>

                    <!-- Quick Links -->
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-4">Quick Links</h4>
                        <ul class="space-y-2">
                            <li>
                                <a onclick="showSection('landing')" class="text-gray-400 hover:text-white transition-colors cursor-pointer flex items-center">
                                    <i class="fas fa-home mr-2 text-sm"></i>Home
                                </a>
                            </li>
                            <li>
                                <a onclick="showSection('editor')" class="text-gray-400 hover:text-white transition-colors cursor-pointer flex items-center">
                                    <i class="fas fa-code mr-2 text-sm"></i>Code Editor
                                </a>
                            </li>
                            <li>
                                <a onclick="showSection('chat')" class="text-gray-400 hover:text-white transition-colors cursor-pointer flex items-center">
                                    <i class="fas fa-comments mr-2 text-sm"></i>AI Chat
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Developer Info -->
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-4">Developer</h4>
                        <div class="space-y-3">
                            <div class="flex items-center text-gray-400">
                                <i class="fas fa-user mr-3 text-red-600"></i>
                                <span>Reaishma N</span>
                            </div>
                            <div class="flex items-center text-gray-400">
                                <i class="fas fa-envelope mr-3 text-red-600"></i>
                                <a href="mailto:vra.9618@gmail.com" class="hover:text-white transition-colors">vra.9618@gmail.com</a>
                            </div>
                            <div class="flex items-center text-gray-400">
                                <i class="fab fa-github mr-3 text-red-600"></i>
                                <a href="https://github.com/Reaishma" target="_blank" rel="noopener noreferrer" class="hover:text-white transition-colors">github.com/Reaishma</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Copyright -->
                <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                    <p class="text-gray-500 text-sm">
                        &copy; 2025 <span class="brand-text">Help Genie</span>. Developed by Reaishma N.
                    </p>
                </div>
            </div>
        </footer>
    </section>

    <!-- Code Editor Section -->
    <section id="editor" class="hidden min-h-screen bg-gray-900 pt-20">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 h-full">
                <!-- File Explorer -->
                <div class="lg:col-span-1 bg-gray-800 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Project Files</h3>
                        <div class="flex space-x-2">
                            <button onclick="createNewFile()" class="p-1 bg-blue-600 hover:bg-blue-700 rounded text-xs">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button onclick="createNewFolder()" class="p-1 bg-green-600 hover:bg-green-700 rounded text-xs">
                                <i class="fas fa-folder-plus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Sample Codes Section -->
                    <div class="mb-4">
                        <h4 class="text-sm font-semibold mb-2 text-gray-400">Sample Codes</h4>
                        <div class="space-y-1 max-h-32 overflow-y-auto">
                            <button onclick="loadSampleCode('java')" class="sample-code-btn"><i class="fas fa-file-code"></i>Java</button>
                            <button onclick="loadSampleCode('cpp')" class="sample-code-btn"><i class="fas fa-file-code"></i>C++</button>
                            <button onclick="loadSampleCode('csharp')" class="sample-code-btn"><i class="fas fa-file-code"></i>C#</button>
                            <button onclick="loadSampleCode('go')" class="sample-code-btn"><i class="fas fa-file-code"></i>Go</button>
                            <button onclick="loadSampleCode('rust')" class="sample-code-btn"><i class="fas fa-file-code"></i>Rust</button>
                            <button onclick="loadSampleCode('php')" class="sample-code-btn"><i class="fas fa-file-code"></i>PHP</button>
                            <button onclick="loadSampleCode('ruby')" class="sample-code-btn"><i class="fas fa-file-code"></i>Ruby</button>
                            <button onclick="loadSampleCode('swift')" class="sample-code-btn"><i class="fas fa-file-code"></i>Swift</button>
                            <button onclick="loadSampleCode('kotlin')" class="sample-code-btn"><i class="fas fa-file-code"></i>Kotlin</button>
                            <button onclick="loadSampleCode('typescript')" class="sample-code-btn"><i class="fas fa-file-code"></i>TypeScript</button>
                            <button onclick="loadSampleCode('sql')" class="sample-code-btn"><i class="fas fa-database"></i>SQL</button>
                            <button onclick="loadSampleCode('r')" class="sample-code-btn"><i class="fas fa-chart-line"></i>R</button>
                            <button onclick="loadSampleCode('scala')" class="sample-code-btn"><i class="fas fa-file-code"></i>Scala</button>
                            <button onclick="loadSampleCode('perl')" class="sample-code-btn"><i class="fas fa-file-code"></i>Perl</button>
                            <button onclick="loadSampleCode('lua')" class="sample-code-btn"><i class="fas fa-file-code"></i>Lua</button>
                            <button onclick="loadSampleCode('bash')" class="sample-code-btn"><i class="fas fa-terminal"></i>Bash</button>
                        </div>
                    </div>
                    
                    <div id="fileTree" class="file-tree">
                        <div class="file-item p-2 rounded flex items-center space-x-2 active bg-gray-700" onclick="selectFile('main.py')">
                            <i class="fas fa-file-code text-gray-400"></i>
                            <span>main.py</span>
                        </div>
                        <div class="file-item p-2 rounded flex items-center space-x-2 hover:bg-gray-700 cursor-pointer" onclick="selectFile('styles.css')">
                            <i class="fas fa-file-code text-gray-400"></i>
                            <span>styles.css</span>
                        </div>
                        <div class="file-item p-2 rounded flex items-center space-x-2 hover:bg-gray-700 cursor-pointer" onclick="selectFile('script.js')">
                            <i class="fas fa-file-code text-gray-400"></i>
                            <span>script.js</span>
                        </div>
                    </div>
                </div>

                <!-- Code Editor -->
                <div class="lg:col-span-3">
                    <div class="bg-gray-800 rounded-lg">
                        <div class="flex justify-between items-center p-4 border-b border-gray-700">
                            <div class="flex items-center space-x-4">
                                <span id="currentFileName" class="font-semibold">main.py</span>
                                <select id="languageSelect" onchange="changeLanguage()" class="bg-gray-700 rounded px-3 py-1 text-sm">
                                    <option value="python">Python 3.8.1</option>
                                    <option value="javascript">JavaScript (Node.js)</option>
                                    <option value="java">Java (OpenJDK 13)</option>
                                    <option value="cpp">C++ (GCC 9.2.0)</option>
                                    <option value="c">C (GCC 9.2.0)</option>
                                    <option value="csharp">C# (Mono 6.6.0)</option>
                                    <option value="go">Go (1.13.5)</option>
                                    <option value="rust">Rust (1.40.0)</option>
                                    <option value="php">PHP (7.4.1)</option>
                                    <option value="ruby">Ruby (2.7.0)</option>
                                    <option value="swift">Swift (5.2.3)</option>
                                    <option value="kotlin">Kotlin (1.3.70)</option>
                                    <option value="typescript">TypeScript (3.7.4)</option>
                                    <option value="sql">SQL (SQLite 3.27.2)</option>
                                    <option value="r">R (4.0.0)</option>
                                    <option value="scala">Scala (2.13.2)</option>
                                    <option value="perl">Perl (5.28.1)</option>
                                    <option value="lua">Lua (5.3.5)</option>
                                    <option value="bash">Bash (5.0.0)</option>
                                    <option value="html">HTML (Preview)</option>
                                    <option value="css">CSS (Preview)</option>
                                </select>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="runCode()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded text-sm">
                                    <i class="fas fa-play mr-1"></i>Run
                                </button>
                                <button onclick="triggerCompletion()" class="px-3 py-2 bg-indigo-600 hover:bg-indigo-700 rounded text-sm" title="AI Code Completion (Ctrl+Space)">
                                    <i class="fas fa-magic mr-1"></i>Complete
                                </button>
                                <button onclick="aiDebug()" class="px-3 py-2 bg-red-600 hover:bg-red-700 rounded text-sm" title="AI Debug Analysis">
                                    <i class="fas fa-bug mr-1"></i>Debug
                                </button>
                                <button onclick="aiSuggest()" class="px-3 py-2 bg-orange-600 hover:bg-orange-700 rounded text-sm" title="AI Suggestions">
                                    <i class="fas fa-lightbulb mr-1"></i>Suggest
                                </button>
                                <button onclick="saveFile()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm">
                                    <i class="fas fa-save mr-1"></i>Save
                                </button>
                                <button onclick="exportProject()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded text-sm">
                                    <i class="fas fa-download mr-1"></i>Export
                                </button>
                            </div>
                        </div>
                        <div id="monacoEditor" class="monaco-editor-container"></div>
                    </div>

                    <!-- AI Analysis Panel -->
                    <div class="mt-6 bg-gray-800 rounded-lg">
                        <div class="p-4 border-b border-gray-700">
                            <div class="flex justify-between items-center">
                                <h3 class="font-semibold">AI Analysis & Output</h3>
                                <div class="flex space-x-2">
                                    <button onclick="showAnalysisTab('output')" id="outputTab" class="px-3 py-1 bg-green-600 rounded text-xs">Output</button>
                                    <button onclick="showAnalysisTab('debug')" id="debugTab" class="px-3 py-1 bg-gray-600 rounded text-xs">Debug</button>
                                    <button onclick="showAnalysisTab('suggestions')" id="suggestTab" class="px-3 py-1 bg-gray-600 rounded text-xs">Suggestions</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Output Tab -->
                        <div id="outputPanel" class="analysis-panel">
                            <div id="codeOutput" class="code-output p-4 h-32 overflow-y-auto">
                                <div class="text-gray-400">Code output will appear here...</div>
                            </div>
                        </div>
                        
                        <!-- Debug Analysis Tab -->
                        <div id="debugPanel" class="analysis-panel hidden">
                            <div id="debugResults" class="p-4 h-32 overflow-y-auto">
                                <div class="text-gray-400">Click "Debug" to analyze your code for potential issues...</div>
                            </div>
                        </div>
                        
                        <!-- Suggestions Tab -->
                        <div id="suggestionsPanel" class="analysis-panel hidden">
                            <div id="suggestionsResults" class="p-4 h-32 overflow-y-auto">
                                <div class="text-gray-400">Click "Suggest" to get AI-powered code improvement suggestions...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Chat Section -->
    <section id="chat" class="hidden min-h-screen bg-gray-900 pt-20 ai-chat-section">
        <div class="container mx-auto px-4 max-w-4xl">
            <div class="bg-gray-800 rounded-lg h-screen max-h-[80vh] flex flex-col">
                <div class="p-4 border-b border-gray-700">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-xl font-semibold">AI Coding Assistant</h2>
                            <div id="connectionStatus" class="text-sm text-yellow-400 mt-1">🔄 Loading AI model...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Messages -->
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <div class="chat-message flex items-start space-x-3">
                        <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-robot text-sm"></i>
                        </div>
                        <div class="flex-1 bg-gray-700 rounded-lg p-3">
                            <p>👋 Hello! I'm your AI coding assistant. I can help you with:</p>
                            <ul class="list-disc list-inside mt-2 text-sm">
                                <li>Generate code in any language</li>
                                <li>Debug and fix errors</li>
                                <li>Explain how code works</li>
                                <li>Create HTML/CSS layouts</li>
                                <li>Algorithm help and best practices</li>
                            </ul>
                            <p class="mt-2">What would you like to work on?</p>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Input -->
                <div class="p-4 border-t border-gray-700">
                    <div class="flex space-x-4">
                        <input type="text" id="chatInput" placeholder="Ask me anything about coding..." 
                               class="flex-1 bg-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-purple-600"
                               onkeypress="handleChatKeyPress(event)">
                        <button onclick="sendMessage()" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="flex space-x-2 mt-2">
                        <button onclick="sendQuickMessage('Create a Python function')" class="text-xs bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded">
                            Python Function
                        </button>
                        <button onclick="sendQuickMessage('Debug my code')" class="text-xs bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded">
                            Debug Help
                        </button>
                        <button onclick="sendQuickMessage('Create HTML page')" class="text-xs bg-gray-700 hover:bg-gray-600 px-2 py-1 rounded">
                            HTML Page
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        let monacoEditor = null;
        let currentProject = {
            files: {
                'main.py': '# Welcome to AI Coder!\n# Start coding or ask AI to generate code for you\n\nprint("Hello, World!")\n\n# Try running this code!\ndef greet(name):\n    return f"Hello, {name}!"\n\nuser_name = "Developer"\nprint(greet(user_name))',
                'styles.css': '/* CSS styles for your project */\nbody {\n    font-family: Arial, sans-serif;\n    margin: 0;\n    padding: 20px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n}\n\n.container {\n    max-width: 800px;\n    margin: 0 auto;\n    padding: 20px;\n    background: rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    backdrop-filter: blur(10px);\n}\n\n.btn {\n    padding: 10px 20px;\n    background: #007bff;\n    color: white;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.btn:hover {\n    background: #0056b3;\n    transform: translateY(-2px);\n}',
                'script.js': '// JavaScript code for your project\nconsole.log("Welcome to AI Coder!");\n\n// DOM manipulation example\ndocument.addEventListener("DOMContentLoaded", function() {\n    console.log("Page loaded successfully!");\n    \n    // Add click event to buttons\n    const buttons = document.querySelectorAll(".btn");\n    buttons.forEach(button => {\n        button.addEventListener("click", function() {\n            console.log("Button clicked:", this.textContent);\n        });\n    });\n});\n\n// Example function\nfunction displayMessage(message) {\n    const messageDiv = document.createElement("div");\n    messageDiv.textContent = message;\n    messageDiv.style.padding = "10px";\n    messageDiv.style.margin = "5px 0";\n    messageDiv.style.background = "#28a745";\n    messageDiv.style.color = "white";\n    messageDiv.style.borderRadius = "5px";\n    document.body.appendChild(messageDiv);\n}\n\n// Call the function\ndisplayMessage("JavaScript is working!");\n\n// Modern async/await example\nasync function fetchData() {\n    try {\n        const response = await fetch("https://api.github.com/users/octocat");\n        const data = await response.json();\n        console.log("GitHub user data:", data);\n        return data;\n    } catch (error) {\n        console.error("Error fetching data:", error);\n    }\n}\n\n// Uncomment to test API call\n// fetchData();'
            },
            currentFile: 'main.py'
        };

        // Sample code templates
        const SAMPLE_CODES = {
            java: `// Java Sample - Object-Oriented Programming
public class HelloWorld {
    private String message;
    
    public HelloWorld(String message) {
        this.message = message;
    }
    
    public void displayMessage() {
        System.out.println(message);
    }
    
    public static void main(String[] args) {
        HelloWorld hello = new HelloWorld("Hello, Java World!");
        hello.displayMessage();
        
        // Array example
        int[] numbers = {1, 2, 3, 4, 5};
        for (int num : numbers) {
            System.out.println("Number: " + num);
        }
        
        // Object-oriented features
        Calculator calc = new Calculator();
        System.out.println("5 + 3 = " + calc.add(5, 3));
    }
}

class Calculator {
    public int add(int a, int b) {
        return a + b;
    }
    
    public double multiply(double a, double b) {
        return a * b;
    }
}`,

            cpp: `// C++ Sample - Modern C++ Features
#include <iostream>
#include <vector>
#include <string>
#include <algorithm>
#include <memory>

class Calculator {
private:
    std::string name;
    
public:
    Calculator(const std::string& n) : name(n) {}
    
    template<typename T>
    T add(T a, T b) {
        return a + b;
    }
    
    void displayInfo() {
        std::cout << "Calculator: " << name << std::endl;
    }
};

int main() {
    Calculator calc("Scientific Calculator");
    calc.displayInfo();
    
    std::cout << "5 + 3 = " << calc.add(5, 3) << std::endl;
    std::cout << "2.5 + 1.7 = " << calc.add(2.5, 1.7) << std::endl;
    
    // Vector example with lambda
    std::vector<int> numbers = {1, 2, 3, 4, 5};
    std::for_each(numbers.begin(), numbers.end(), [](int n) {
        std::cout << "Square of " << n << " is " << n * n << std::endl;
    });
    
    // Smart pointers
    auto ptr = std::make_unique<Calculator>("Smart Calculator");
    ptr->displayInfo();
    
    return 0;
}`,

            csharp: `// C# Sample - Modern C# Features
using System;
using System.Collections.Generic;
using System.Linq;

namespace HelloWorld
{
    public class Person
    {
        public string Name { get; set; }
        public int Age { get; set; }
        
        public Person(string name, int age)
        {
            Name = name;
            Age = age;
        }
        
        public void Introduce()
        {
            Console.WriteLine($"Hello, I'm {Name} and I'm {Age} years old.");
        }
    }
    
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("C# Sample Application");
            
            var people = new List<Person>
            {
                new Person("Alice", 30),
                new Person("Bob", 25),
                new Person("Charlie", 35)
            };
            
            // LINQ example
            var adults = people.Where(p => p.Age >= 18).OrderBy(p => p.Age);
            
            foreach (var person in adults)
            {
                person.Introduce();
            }
            
            Console.WriteLine($"Average age: {people.Average(p => p.Age):F1}");
            
            // Pattern matching (C# 7+)
            foreach (var person in people)
            {
                var description = person.Age switch
                {
                    < 30 => "Young adult",
                    >= 30 and < 60 => "Middle-aged",
                    _ => "Senior"
                };
                Console.WriteLine($"{person.Name} is {description}");
            }
        }
    }
}`,

            go: `// Go Sample - Concurrent Programming
package main

import (
    "fmt"
    "sync"
    "time"
)

type Person struct {
    Name string
    Age  int
}

func (p Person) Introduce() {
    fmt.Printf("Hello, I'm %s and I'm %d years old.\\n", p.Name, p.Age)
}

func worker(id int, jobs <-chan int, results chan<- int, wg *sync.WaitGroup) {
    defer wg.Done()
    for j := range jobs {
        fmt.Printf("Worker %d processing job %d\\n", id, j)
        time.Sleep(time.Millisecond * 100)
        results <- j * 2
    }
}

func fibonacci(n int) int {
    if n <= 1 {
        return n
    }
    return fibonacci(n-1) + fibonacci(n-2)
}

func main() {
    fmt.Println("Go Sample Application")
    
    // Struct example
    person := Person{Name: "Alice", Age: 30}
    person.Introduce()
    
    // Goroutines and channels example
    const numJobs = 5
    jobs := make(chan int, numJobs)
    results := make(chan int, numJobs)
    
    var wg sync.WaitGroup
    
    // Start 2 workers
    for w := 1; w <= 2; w++ {
        wg.Add(1)
        go worker(w, jobs, results, &wg)
    }
    
    // Send jobs
    for j := 1; j <= numJobs; j++ {
        jobs <- j
    }
    close(jobs)
    
    // Wait for all workers to complete
    go func() {
        wg.Wait()
        close(results)
    }()
    
    // Collect results
    for result := range results {
        fmt.Printf("Result: %d\\n", result)
    }
    
    // Fibonacci example
    fmt.Printf("Fibonacci(10) = %d\\n", fibonacci(10))
}`,

            rust: `// Rust Sample - Ownership and Safety
use std::collections::HashMap;

#[derive(Debug)]
struct Person {
    name: String,
    age: u32,
}

impl Person {
    fn new(name: String, age: u32) -> Self {
        Person { name, age }
    }
    
    fn introduce(&self) {
        println!("Hello, I'm {} and I'm {} years old.", self.name, self.age);
    }
    
    fn have_birthday(&mut self) {
        self.age += 1;
        println!("{} is now {} years old!", self.name, self.age);
    }
}

fn fibonacci(n: u32) -> u32 {
    match n {
        0 => 0,
        1 => 1,
        _ => fibonacci(n - 1) + fibonacci(n - 2),
    }
}

fn main() {
    println!("Rust Sample Application");
    
    let mut person = Person::new("Alice".to_string(), 30);
    person.introduce();
    person.have_birthday();
    
    // Vector operations
    let numbers: Vec<i32> = (1..6).collect();
    let doubled: Vec<i32> = numbers.iter().map(|x| x * 2).collect();
    println!("Original: {:?}", numbers);
    println!("Doubled: {:?}", doubled);
    
    // HashMap example
    let mut scores = HashMap::new();
    scores.insert("Alice", 100);
    scores.insert("Bob", 85);
    
    for (name, score) in &scores {
        println!("{}: {}", name, score);
    }
    
    // Pattern matching with Option
    let maybe_score = scores.get("Alice");
    match maybe_score {
        Some(score) => println!("Alice's score: {}", score),
        None => println!("Alice's score not found"),
    }
    
    // Fibonacci example
    for i in 0..10 {
        println!("fib({}) = {}", i, fibonacci(i));
    }
    
    // Error handling with Result
    let result: Result<i32, &str> = Ok(42);
    match result {
        Ok(value) => println!("Success: {}", value),
        Err(error) => println!("Error: {}", error),
    }
}`,

            php: `<?php
// PHP Sample - Modern PHP Features

class Person {
    private string $name;
    private int $age;
    
    public function __construct(string $name, int $age) {
        $this->name = $name;
        $this->age = $age;
    }
    
    public function introduce(): void {
        echo "Hello, I'm {$this->name} and I'm {$this->age} years old.\\n";
    }
    
    public function getName(): string {
        return $this->name;
    }
    
    public function getAge(): int {
        return $this->age;
    }
}

function fibonacci(int $n): int {
    if ($n <= 1) {
        return $n;
    }
    return fibonacci($n - 1) + fibonacci($n - 2);
}

// Main execution
echo "PHP Sample Application\\n";

$people = [
    new Person("Alice", 30),
    new Person("Bob", 25),
    new Person("Charlie", 35)
];

foreach ($people as $person) {
    $person->introduce();
}

// Array manipulation
$numbers = [1, 2, 3, 4, 5];
$squared = array_map(fn($n) => $n * $n, $numbers);

echo "Original: " . implode(", ", $numbers) . "\\n";
echo "Squared: " . implode(", ", $squared) . "\\n";

// Associative array
$scores = [
    "Alice" => 100,
    "Bob" => 85,
    "Charlie" => 92
];

foreach ($scores as $name => $score) {
    echo "$name: $score\\n";
}

// Filter example
$highScores = array_filter($scores, fn($score) => $score > 90);
echo "High scores: " . json_encode($highScores) . "\\n";

// Fibonacci sequence
echo "Fibonacci sequence: ";
for ($i = 0; $i < 10; $i++) {
    echo fibonacci($i) . " ";
}
echo "\\n";
?>`,

            ruby: `# Ruby Sample - Object-Oriented and Functional Features

class Person
  attr_reader :name, :age
  
  def initialize(name, age)
    @name = name
    @age = age
  end
  
  def introduce
    puts "Hello, I'm #{@name} and I'm #{@age} years old."
  end
  
  def have_birthday
    @age += 1
    puts "#{@name} is now #{@age} years old!"
  end
end

def fibonacci(n)
  return n if n <= 1
  fibonacci(n - 1) + fibonacci(n - 2)
end

# Main execution
puts "Ruby Sample Application"

people = [
  Person.new("Alice", 30),
  Person.new("Bob", 25),
  Person.new("Charlie", 35)
]

people.each(&:introduce)

# Array operations
numbers = (1..5).to_a
squared = numbers.map { |n| n ** 2 }

puts "Original: #{numbers}"
puts "Squared: #{squared}"

# Hash operations
scores = {
  "Alice" => 100,
  "Bob" => 85,
  "Charlie" => 92
}

scores.each do |name, score|
  puts "#{name}: #{score}"
end

# Select with condition
high_scores = scores.select { |name, score| score > 90 }
puts "High scores: #{high_scores}"

# Fibonacci sequence
puts "Fibonacci sequence: #{(0...10).map { |i| fibonacci(i) }.join(' ')}"

# Block example
puts "Even numbers: #{(1..10).select(&:even?)}"

# String interpolation and methods
greeting = "Hello"
target = "World"
puts "#{greeting}, #{target}!".upcase`,

            swift: `// Swift Sample - Modern Swift Features
import Foundation

struct Person {
    let name: String
    var age: Int
    
    func introduce() {
        print("Hello, I'm \\(name) and I'm \\(age) years old.")
    }
    
    mutating func haveBirthday() {
        age += 1
        print("\\(name) is now \\(age) years old!")
    }
}

class Calculator {
    func add(_ a: Int, _ b: Int) -> Int {
        return a + b
    }
    
    func fibonacci(_ n: Int) -> Int {
        guard n > 1 else { return n }
        return fibonacci(n - 1) + fibonacci(n - 2)
    }
}

func processNumbers(_ numbers: [Int], transform: (Int) -> Int) -> [Int] {
    return numbers.map(transform)
}

// Main execution
print("Swift Sample Application")

var people = [
    Person(name: "Alice", age: 30),
    Person(name: "Bob", age: 25),
    Person(name: "Charlie", age: 35)
]

for person in people {
    person.introduce()
}

// Array operations
let numbers = Array(1...5)
let squared = processNumbers(numbers) { $0 * $0 }

print("Original: \\(numbers)")
print("Squared: \\(squared)")

// Dictionary operations
let scores = [
    "Alice": 100,
    "Bob": 85,
    "Charlie": 92
]

for (name, score) in scores {
    print("\\(name): \\(score)")
}

// Filter example
let highScores = scores.filter { $0.value > 90 }
print("High scores: \\(highScores)")

// Calculator example
let calc = Calculator()
print("5 + 3 = \\(calc.add(5, 3))")

// Fibonacci sequence
let fibSequence = (0..<10).map { calc.fibonacci($0) }
print("Fibonacci sequence: \\(fibSequence)")

// Optional handling
let optionalName: String? = "Swift"
if let name = optionalName {
    print("Hello, \\(name)!")
} else {
    print("Hello, unknown!")
}

// Closures
let evenNumbers = numbers.filter { $0 % 2 == 0 }
print("Even numbers: \\(evenNumbers)")`,

            kotlin: `// Kotlin Sample - Modern Android Development
fun main() {
    println("Kotlin Sample Application")
    
    val people = listOf(
        Person("Alice", 30),
        Person("Bob", 25),
        Person("Charlie", 35)
    )
    
    people.forEach { it.introduce() }
    
    // Collection operations
    val numbers = (1..5).toList()
    val squared = numbers.map { it * it }
    
    println("Original: $numbers")
    println("Squared: $squared")
    
    // Map operations
    val scores = mapOf(
        "Alice" to 100,
        "Bob" to 85,
        "Charlie" to 92
    )
    
    scores.forEach { (name, score) ->
        println("$name: $score")
    }
    
    // Filter example
    val highScores = scores.filter { it.value > 90 }
    println("High scores: $highScores")
    
    // Calculator example
    val calc = Calculator()
    println("5 + 3 = \${calc.add(5, 3)}")
    
    // Fibonacci sequence
    val fibSequence = (0 until 10).map { fibonacci(it) }
    println("Fibonacci sequence: $fibSequence")
    
    // When expression
    val grade = 85
    val letterGrade = when {
        grade >= 90 -> "A"
        grade >= 80 -> "B"
        grade >= 70 -> "C"
        grade >= 60 -> "D"
        else -> "F"
    }
    println("Grade $grade is $letterGrade")
    
    // Extension function example
    println("Hello World".isPalindrome())
}

data class Person(val name: String, var age: Int) {
    fun introduce() {
        println("Hello, I'm $name and I'm $age years old.")
    }
    
    fun haveBirthday() {
        age++
        println("$name is now $age years old!")
    }
}

class Calculator {
    fun add(a: Int, b: Int): Int = a + b
    
    fun multiply(a: Double, b: Double): Double = a * b
}

tailrec fun fibonacci(n: Int, a: Int = 0, b: Int = 1): Int {
    return when (n) {
        0 -> a
        1 -> b
        else -> fibonacci(n - 1, b, a + b)
    }
}

// Extension function
fun String.isPalindrome(): Boolean {
    val cleaned = this.lowercase().replace(Regex("[^a-z0-9]"), "")
    return cleaned == cleaned.reversed()
}`,

            typescript: `// TypeScript Sample - Advanced Type System
interface Person {
  name: string;
  age: number;
  introduce(): void;
}

class Developer implements Person {
  constructor(
    public name: string,
    public age: number,
    public languages: string[]
  ) {}

  introduce(): void {
    console.log(\`Hello, I'm \${this.name}, \${this.age} years old, and I code in \${this.languages.join(', ')}.\`);
  }

  addLanguage(language: string): void {
    if (!this.languages.includes(language)) {
      this.languages.push(language);
      console.log(\`Added \${language} to \${this.name}'s skills!\`);
    }
  }
}

// Generic function
function processArray<T>(items: T[], processor: (item: T) => T): T[] {
  return items.map(processor);
}

// Type aliases and union types
type Status = 'pending' | 'completed' | 'failed';
type ApiResponse<T> = {
  data: T;
  status: Status;
  message: string;
};

// Advanced types
interface Calculator {
  add(a: number, b: number): number;
  subtract(a: number, b: number): number;
}

class ScientificCalculator implements Calculator {
  add(a: number, b: number): number {
    return a + b;
  }

  subtract(a: number, b: number): number {
    return a - b;
  }

  power(base: number, exponent: number): number {
    return Math.pow(base, exponent);
  }
}

// Async/await with proper typing
async function fetchUserData(userId: number): Promise<ApiResponse<Person>> {
  try {
    // Simulated API call
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    return {
      data: {
        name: "John Doe",
        age: 30,
        introduce: () => console.log("Hello!")
      },
      status: 'completed',
      message: 'User data fetched successfully'
    };
  } catch (error) {
    return {
      data: {} as Person,
      status: 'failed',
      message: 'Failed to fetch user data'
    };
  }
}

// Main execution
console.log("TypeScript Sample Application");

const developers: Developer[] = [
  new Developer("Alice", 30, ["TypeScript", "React"]),
  new Developer("Bob", 25, ["JavaScript", "Node.js"]),
  new Developer("Charlie", 35, ["TypeScript", "Angular"])
];

developers.forEach(dev => dev.introduce());

// Generic function usage
const numbers = [1, 2, 3, 4, 5];
const squared = processArray(numbers, n => n * n);
console.log("Squared numbers:", squared);

// Calculator usage
const calc = new ScientificCalculator();
console.log("5 + 3 =", calc.add(5, 3));
console.log("2^8 =", calc.power(2, 8));

// Async function usage
fetchUserData(123).then(response => {
  console.log("API Response:", response);
});

// Destructuring and spread operator
const [first, ...rest] = numbers;
console.log("First:", first, "Rest:", rest);

const newDev = { ...developers[0], age: 31 };
console.log("Updated developer:", newDev);`,

            sql: `-- SQL Sample - Database Operations

-- Create tables
CREATE TABLE departments (
    id INTEGER PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    budget DECIMAL(10,2)
);

CREATE TABLE employees (
    id INTEGER PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    salary DECIMAL(10,2),
    hire_date DATE,
    department_id INTEGER,
    FOREIGN KEY (department_id) REFERENCES departments(id)
);

-- Insert sample data
INSERT INTO departments (id, name, budget) VALUES 
(1, 'Engineering', 500000.00),
(2, 'Marketing', 200000.00),
(3, 'Sales', 300000.00),
(4, 'HR', 150000.00);

INSERT INTO employees (id, first_name, last_name, email, salary, hire_date, department_id) VALUES 
(1, 'John', 'Doe', 'john.doe@company.com', 75000.00, '2022-01-15', 1),
(2, 'Jane', 'Smith', 'jane.smith@company.com', 82000.00, '2021-03-22', 1),
(3, 'Bob', 'Johnson', 'bob.johnson@company.com', 65000.00, '2022-06-10', 2),
(4, 'Alice', 'Brown', 'alice.brown@company.com', 70000.00, '2021-11-05', 3),
(5, 'Charlie', 'Davis', 'charlie.davis@company.com', 58000.00, '2023-02-14', 4);

-- Basic SELECT queries
SELECT * FROM employees;

SELECT first_name, last_name, salary 
FROM employees 
WHERE salary > 70000;

-- JOIN operations
SELECT 
    e.first_name,
    e.last_name,
    e.salary,
    d.name as department_name
FROM employees e
JOIN departments d ON e.department_id = d.id
ORDER BY e.salary DESC;

-- Aggregate functions
SELECT 
    d.name as department,
    COUNT(e.id) as employee_count,
    AVG(e.salary) as avg_salary,
    MAX(e.salary) as max_salary,
    MIN(e.salary) as min_salary
FROM departments d
LEFT JOIN employees e ON d.id = e.department_id
GROUP BY d.id, d.name
ORDER BY avg_salary DESC;

-- Subqueries
SELECT first_name, last_name, salary
FROM employees
WHERE salary > (
    SELECT AVG(salary) 
    FROM employees
);

-- Window functions
SELECT 
    first_name,
    last_name,
    salary,
    department_id,
    ROW_NUMBER() OVER (PARTITION BY department_id ORDER BY salary DESC) as rank_in_dept,
    AVG(salary) OVER (PARTITION BY department_id) as dept_avg_salary
FROM employees;

-- Common Table Expressions (CTE)
WITH department_stats AS (
    SELECT 
        department_id,
        COUNT(*) as emp_count,
        AVG(salary) as avg_salary
    FROM employees
    GROUP BY department_id
)
SELECT 
    d.name,
    ds.emp_count,
    ds.avg_salary,
    d.budget / ds.emp_count as budget_per_employee
FROM departments d
JOIN department_stats ds ON d.id = ds.department_id;

-- Update and Delete operations
UPDATE employees 
SET salary = salary * 1.05 
WHERE department_id = 1;

-- Create indexes for better performance
CREATE INDEX idx_employee_department ON employees(department_id);
CREATE INDEX idx_employee_salary ON employees(salary);

-- Views
CREATE VIEW high_earners AS
SELECT 
    e.first_name,
    e.last_name,
    e.salary,
    d.name as department
FROM employees e
JOIN departments d ON e.department_id = d.id
WHERE e.salary > 70000;

SELECT * FROM high_earners;`,

            r: `# R Sample - Data Analysis and Statistics

# Load required libraries
library(ggplot2)  # For plotting (if available)

# Create sample data
print("R Sample - Data Analysis Application")

# Vectors and basic operations
numbers <- c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
names <- c("Alice", "Bob", "Charlie", "Diana", "Eve")
ages <- c(25, 30, 35, 28, 32)

# Data frame
people <- data.frame(
  Name = names,
  Age = ages,
  Salary = c(50000, 60000, 75000, 55000, 68000),
  Department = c("Engineering", "Marketing", "Engineering", "HR", "Marketing")
)

print("People data:")
print(people)

# Basic statistics
cat("\\nBasic Statistics:\\n")
cat("Mean age:", mean(people$Age), "\\n")
cat("Median salary:", median(people$Salary), "\\n")
cat("Standard deviation of salary:", sd(people$Salary), "\\n")

# Data manipulation
high_earners <- subset(people, Salary > 60000)
cat("\\nHigh earners (> $60,000):\\n")
print(high_earners)

# Aggregation
dept_summary <- aggregate(cbind(Age, Salary) ~ Department, data = people, FUN = mean)
cat("\\nDepartment averages:\\n")
print(dept_summary)

# Functions
fibonacci <- function(n) {
  if (n <= 1) {
    return(n)
  } else {
    return(fibonacci(n - 1) + fibonacci(n - 2))
  }
}

# Generate Fibonacci sequence
fib_sequence <- sapply(0:10, fibonacci)
cat("\\nFibonacci sequence:", fib_sequence, "\\n")

# Matrix operations
matrix_a <- matrix(c(1, 2, 3, 4), nrow = 2)
matrix_b <- matrix(c(5, 6, 7, 8), nrow = 2)

cat("\\nMatrix A:\\n")
print(matrix_a)
cat("Matrix B:\\n")
print(matrix_b)
cat("Matrix multiplication (A %*% B):\\n")
print(matrix_a %*% matrix_b)

# Lists and advanced data structures
person_list <- list(
  name = "John Doe",
  age = 35,
  hobbies = c("reading", "swimming", "coding"),
  address = list(
    street = "123 Main St",
    city = "Anytown",
    zip = "12345"
  )
)

cat("\\nPerson information:\\n")
print(person_list$name)
print(person_list$hobbies)

# Statistical analysis
set.seed(123)  # For reproducible results
sample_data <- rnorm(100, mean = 50, sd = 10)

cat("\\nSample data statistics:\\n")
cat("Mean:", mean(sample_data), "\\n")
cat("Standard deviation:", sd(sample_data), "\\n")
cat("Min:", min(sample_data), "\\n")
cat("Max:", max(sample_data), "\\n")

# Correlation analysis
correlation <- cor(people$Age, people$Salary)
cat("\\nCorrelation between Age and Salary:", correlation, "\\n")

# Linear regression
model <- lm(Salary ~ Age, data = people)
cat("\\nLinear regression summary:\\n")
print(summary(model))

# Apply functions
squared_numbers <- sapply(numbers, function(x) x^2)
cat("\\nSquared numbers:", squared_numbers, "\\n")

# Control structures
cat("\\nEven numbers from 1-10: ")
for (i in numbers) {
  if (i %% 2 == 0) {
    cat(i, " ")
  }
}
cat("\\n")`,

            scala: `// Scala Sample - Functional Programming and Big Data
object ScalaSample extends App {
  println("Scala Sample Application")
  
  // Case classes
  case class Person(name: String, age: Int, department: String)
  
  val people = List(
    Person("Alice", 30, "Engineering"),
    Person("Bob", 25, "Marketing"),
    Person("Charlie", 35, "Engineering"),
    Person("Diana", 28, "HR")
  )
  
  println("\\nPeople:")
  people.foreach(println)
  
  // Functional programming operations
  val engineers = people.filter(_.department == "Engineering")
  val names = people.map(_.name)
  val avgAge = people.map(_.age).sum.toDouble / people.length
  
  println(s"\\nEngineers: $engineers")
  println(s"Names: $names")
  println(s"Average age: $avgAge")
  
  // Pattern matching
  def describeAge(person: Person): String = person.age match {
    case age if age < 25 => "Young"
    case age if age < 35 => "Middle-aged"
    case _ => "Senior"
  }
  
  println("\\nAge descriptions:")
  people.foreach(p => println(s"\${p.name} is \${describeAge(p)}"))
  
  // Higher-order functions
  def processNumbers(numbers: List[Int], operation: Int => Int): List[Int] = {
    numbers.map(operation)
  }
  
  val numbers = (1 to 10).toList
  val squared = processNumbers(numbers, x => x * x)
  val doubled = processNumbers(numbers, _ * 2)
  
  println(s"\\nNumbers: $numbers")
  println(s"Squared: $squared")
  println(s"Doubled: $doubled")
  
  // Tail-recursive Fibonacci
  def fibonacci(n: Int): Int = {
    def fibHelper(n: Int, a: Int, b: Int): Int = {
      if (n == 0) a
      else fibHelper(n - 1, b, a + b)
    }
    fibHelper(n, 0, 1)
  }
  
  val fibSequence = (0 to 10).map(fibonacci)
  println(s"\\nFibonacci sequence: $fibSequence")
  
  // Option handling
  def findPerson(name: String): Option[Person] = {
    people.find(_.name == name)
  }
  
  findPerson("Alice") match {
    case Some(person) => println(s"\\nFound: $person")
    case None => println("\\nPerson not found")
  }
  
  // Collections and grouping
  val peopleByDept = people.groupBy(_.department)
  println("\\nPeople by department:")
  peopleByDept.foreach { case (dept, ppl) =>
    println(s"$dept: \${ppl.map(_.name).mkString(", ")}")
  }
  
  // For comprehensions
  val engineerNames = for {
    person <- people
    if person.department == "Engineering"
  } yield person.name.toUpperCase
  
  println(s"\\nEngineer names (uppercase): $engineerNames")
  
  // Traits and mixins
  trait Greeter {
    def greet(name: String): String = s"Hello, $name!"
  }
  
  trait TimeGreeter extends Greeter {
    override def greet(name: String): String = {
      val hour = java.time.LocalTime.now().getHour
      val timeOfDay = if (hour < 12) "morning" else if (hour < 17) "afternoon" else "evening"
      s"Good $timeOfDay, $name!"
    }
  }
  
  object Messenger extends TimeGreeter
  
  println(s"\\n\${Messenger.greet("Scala Developer")}")
  
  // Implicit classes (extension methods)
  implicit class RichInt(n: Int) {
    def factorial: Int = if (n <= 1) 1 else n * (n - 1).factorial
    def isEven: Boolean = n % 2 == 0
  }
  
  println(s"\\n5! = \${5.factorial}")
  println(s"4 is even: \${4.isEven}")
  println(s"7 is even: \${7.isEven}")
}`,

            perl: `#!/usr/bin/perl
# Perl Sample - Text Processing and System Administration

use strict;
use warnings;
use Data::Dumper;

print "Perl Sample Application\\n";

# Variables and data types
my $name = "Perl Developer";
my $age = 30;
my @languages = ("Perl", "Python", "Shell");
my %person = (
    name => "Alice",
    age => 35,
    department => "Engineering"
);

print "Name: $name\\n";
print "Age: $age\\n";
print "Languages: " . join(", ", @languages) . "\\n";

# Hash operations
print "\\nPerson information:\\n";
foreach my $key (keys %person) {
    print "$key: $person{$key}\\n";
}

# Subroutines
sub fibonacci {
    my $n = shift;
    return $n if $n <= 1;
    return fibonacci($n - 1) + fibonacci($n - 2);
}

sub greet {
    my ($name, $greeting) = @_;
    $greeting ||= "Hello";
    return "$greeting, $name!";
}

print "\\n" . greet("World") . "\\n";
print greet("Perl", "Hi") . "\\n";

# Array operations
my @numbers = (1..10);
my @squared = map { $_ * $_ } @numbers;
my @evens = grep { $_ % 2 == 0 } @numbers;

print "\\nNumbers: " . join(" ", @numbers) . "\\n";
print "Squared: " . join(" ", @squared) . "\\n";
print "Evens: " . join(" ", @evens) . "\\n";

# Regular expressions
my $text = "The quick brown fox jumps over the lazy dog";
print "\\nOriginal text: $text\\n";

# Pattern matching
if ($text =~ /quick (\\w+) fox/) {
    print "Found: $1\\n";
}

# Substitution
my $modified = $text;
$modified =~ s/fox/cat/g;
print "Modified: $modified\\n";

# Extract all words
my @words = $text =~ /(\\w+)/g;
print "Words found: " . join(", ", @words) . "\\n";

# File operations (simulated)
my @file_content = (
    "line 1: some data",
    "line 2: more data", 
    "line 3: final data"
);

print "\\nProcessing file content:\\n";
foreach my $line (@file_content) {
    if ($line =~ /^line (\\d+): (.+)/) {
        print "Line number: $1, Content: $2\\n";
    }
}

# References and complex data structures
my @employees = (
    { name => "John", age => 30, dept => "Engineering" },
    { name => "Jane", age => 28, dept => "Marketing" },
    { name => "Bob",  age => 35, dept => "Sales" }
);

print "\\nEmployees:\\n";
foreach my $emp (@employees) {
    print "$emp->{name} ($emp->{age}) - $emp->{dept}\\n";
}

# Sort employees by age
my @sorted_by_age = sort { $a->{age} <=> $b->{age} } @employees;
print "\\nSorted by age:\\n";
foreach my $emp (@sorted_by_age) {
    print "$emp->{name} - $emp->{age}\\n";
}

# Fibonacci sequence
print "\\nFibonacci sequence: ";
for my $i (0..10) {
    print fibonacci($i) . " ";
}
print "\\n";

# Hash of arrays
my %departments = (
    Engineering => ["Alice", "Bob", "Charlie"],
    Marketing => ["Diana", "Eve"],
    Sales => ["Frank", "Grace", "Henry"]
);

print "\\nDepartments:\\n";
foreach my $dept (keys %departments) {
    print "$dept: " . join(", ", @{$departments{$dept}}) . "\\n";
}

# String manipulation
my $sample_string = "  Hello World  ";
print "\\nOriginal: '$sample_string'\\n";
print "Trimmed: '" . trim($sample_string) . "'\\n";
print "Uppercase: '" . uc(trim($sample_string)) . "'\\n";

sub trim {
    my $string = shift;
    $string =~ s/^\\s+|\\s+$//g;
    return $string;
}

# Context-sensitive operations
my @result = split /\\s+/, $text;
my $result = split /\\s+/, $text;
print "\\nArray context: " . scalar(@result) . " words\\n";
print "Scalar context: $result words\\n";

print "\\nPerl sample completed!\\n";`,

            lua: `-- Lua Sample - Embedded Scripting and Game Development

print("Lua Sample Application")

-- Variables and basic types
local name = "Lua Developer"
local age = 30
local is_programmer = true

print("Name: " .. name)
print("Age: " .. age)
print("Is programmer: " .. tostring(is_programmer))

-- Tables (Lua's primary data structure)
local person = {
    name = "Alice",
    age = 35,
    department = "Engineering",
    skills = {"Lua", "C++", "Python"}
}

print("\\nPerson information:")
print("Name: " .. person.name)
print("Age: " .. person.age)
print("Department: " .. person.department)
print("Skills: " .. table.concat(person.skills, ", "))

-- Functions
function fibonacci(n)
    if n <= 1 then
        return n
    else
        return fibonacci(n - 1) + fibonacci(n - 2)
    end
end

function greet(name, greeting)
    greeting = greeting or "Hello"
    return greeting .. ", " .. name .. "!"
end

print("\\n" .. greet("World"))
print(greet("Lua", "Hi"))

-- Tables as arrays
local numbers = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
local squared = {}
local evens = {}

for i, num in ipairs(numbers) do
    squared[i] = num * num
    if num % 2 == 0 then
        table.insert(evens, num)
    end
end

print("\\nNumbers: " .. table.concat(numbers, " "))
print("Squared: " .. table.concat(squared, " "))
print("Evens: " .. table.concat(evens, " "))

-- Metatables (Lua's object-oriented programming)
local Calculator = {}
Calculator.__index = Calculator

function Calculator:new()
    local obj = {}
    setmetatable(obj, Calculator)
    return obj
end

function Calculator:add(a, b)
    return a + b
end

function Calculator:multiply(a, b)
    return a * b
end

function Calculator:power(base, exponent)
    return base ^ exponent
end

-- Using the Calculator
local calc = Calculator:new()
print("\\n5 + 3 = " .. calc:add(5, 3))
print("4 * 6 = " .. calc:multiply(4, 6))
print("2^8 = " .. calc:power(2, 8))

-- Closures and higher-order functions
function createMultiplier(factor)
    return function(x)
        return x * factor
    end
end

local double = createMultiplier(2)
local triple = createMultiplier(3)

print("\\nDouble 5: " .. double(5))
print("Triple 4: " .. triple(4))

-- Table manipulation
local employees = {
    {name = "John", age = 30, dept = "Engineering"},
    {name = "Jane", age = 28, dept = "Marketing"},
    {name = "Bob", age = 35, dept = "Engineering"}
}

print("\\nEmployees:")
for i, emp in ipairs(employees) do
    print(string.format("%d. %s (%d) - %s", i, emp.name, emp.age, emp.dept))
end

-- Filter engineers
local engineers = {}
for _, emp in ipairs(employees) do
    if emp.dept == "Engineering" then
        table.insert(engineers, emp)
    end
end

print("\\nEngineers:")
for _, eng in ipairs(engineers) do
    print(eng.name)
end

-- String manipulation
local text = "The quick brown fox jumps over the lazy dog"
print("\\nOriginal text: " .. text)

-- Pattern matching
local word = string.match(text, "quick (%w+) fox")
if word then
    print("Found word: " .. word)
end

-- String substitution
local modified = string.gsub(text, "fox", "cat")
print("Modified: " .. modified)

-- Split string
function split(str, delimiter)
    local result = {}
    local pattern = "([^" .. delimiter .. "]+)"
    for word in string.gmatch(str, pattern) do
        table.insert(result, word)
    end
    return result
end

local words = split(text, " ")
print("Words: " .. table.concat(words, ", "))

-- Fibonacci sequence
print("\\nFibonacci sequence:")
for i = 0, 10 do
    io.write(fibonacci(i) .. " ")
end
print()

-- Coroutines (Lua's cooperative multitasking)
function countUp(max)
    for i = 1, max do
        print("Count: " .. i)
        coroutine.yield(i)
    end
end

local co = coroutine.create(function() countUp(5) end)

print("\\nCoroutine example:")
while coroutine.status(co) ~= "dead" do
    local success, value = coroutine.resume(co)
    if value then
        print("Yielded: " .. value)
    end
end

-- Error handling
function divideNumbers(a, b)
    if b == 0 then
        error("Division by zero!")
    end
    return a / b
end

print("\\nError handling:")
local success, result = pcall(divideNumbers, 10, 2)
if success then
    print("10 / 2 = " .. result)
else
    print("Error: " .. result)
end

local success2, result2 = pcall(divideNumbers, 10, 0)
if success2 then
    print("10 / 0 = " .. result2)
else
    print("Error caught: " .. result2)
end

print("\\nLua sample completed!")`,

            bash: `#!/bin/bash
# Bash Sample - System Administration and Automation

echo "Bash Sample Script"
echo "=================="

# Variables
name="Bash Developer"
age=30
current_date=$(date +"%Y-%m-%d")
current_dir=$(pwd)

echo "Name: $name"
echo "Age: $age"
echo "Current date: $current_date"
echo "Current directory: $current_dir"

# Arrays
languages=("Bash" "Python" "JavaScript" "Go")
numbers=(1 2 3 4 5 6 7 8 9 10)

echo -e "\\nLanguages:"
for lang in "\${languages[@]}"; do
    echo "- $lang"
done

# Functions
fibonacci() {
    local n=$1
    if [ $n -le 1 ]; then
        echo $n
    else
        local a=$(fibonacci $((n - 1)))
        local b=$(fibonacci $((n - 2)))
        echo $((a + b))
    fi
}

greet() {
    local name=\${1:-"World"}
    local greeting=\${2:-"Hello"}
    echo "$greeting, $name!"
}

echo -e "\\n$(greet)"
echo "$(greet "Bash" "Hi")"

# Control structures
echo -e "\\nEven numbers from 1-10:"
for num in "\${numbers[@]}"; do
    if [ $((num % 2)) -eq 0 ]; then
        echo -n "$num "
    fi
done
echo

# String manipulation
text="The quick brown fox jumps over the lazy dog"
echo -e "\\nOriginal text: $text"
echo "Length: \${#text}"
echo "Uppercase: \${text^^}"
echo "First word: \${text%% *}"
echo "Last word: \${text##* }"

# Replace text
modified="\${text/fox/cat}"
echo "Modified: $modified"

# File operations (simulated with arrays)
declare -a file_lines=(
    "line 1: some data"
    "line 2: more data" 
    "line 3: final data"
)

echo -e "\\nProcessing file content:"
line_number=1
for line in "\${file_lines[@]}"; do
    echo "Line $line_number: $line"
    ((line_number++))
done

# Associative arrays (Bash 4+)
declare -A person_info
person_info[name]="Alice"
person_info[age]="35"
person_info[department]="Engineering"

echo -e "\\nPerson information:"
for key in "\${!person_info[@]}"; do
    echo "$key: \${person_info[$key]}"
done

# Command substitution and pipes
echo -e "\\nSystem information:"
echo "Hostname: $(hostname 2>/dev/null || echo 'localhost')"
echo "User: $(whoami 2>/dev/null || echo 'user')"
echo "Date: $(date)"

# Process numbers
echo -e "\\nNumber operations:"
sum=0
for num in "\${numbers[@]}"; do
    sum=$((sum + num))
done
echo "Sum of numbers: $sum"
echo "Average: $((sum / \${#numbers[@]}))"

# Generate squared numbers
squared_numbers=()
for num in "\${numbers[@]}"; do
    squared_numbers+=($((num * num)))
done
echo "Squared numbers: \${squared_numbers[*]}"

# Conditional statements
check_number() {
    local num=$1
    if [ $num -gt 50 ]; then
        echo "$num is large"
    elif [ $num -gt 20 ]; then
        echo "$num is medium"
    else
        echo "$num is small"
    fi
}

echo -e "\\nChecking numbers:"
for num in 15 35 75; do
    check_number $num
done

# Case statement
process_file_extension() {
    local filename=$1
    local extension="\${filename##*.}"
    
    case $extension in
        txt|md)
            echo "$filename is a text file"
            ;;
        jpg|png|gif)
            echo "$filename is an image file"
            ;;
        sh|bash)
            echo "$filename is a shell script"
            ;;
        *)
            echo "$filename has unknown extension: $extension"
            ;;
    esac
}

echo -e "\\nFile type detection:"
sample_files=("script.sh" "image.jpg" "document.txt" "data.csv")
for file in "\${sample_files[@]}"; do
    process_file_extension "$file"
done

# Mathematical operations
echo -e "\\nMathematical operations:"
echo "5 + 3 = $((5 + 3))"
echo "10 - 4 = $((10 - 4))"
echo "6 * 7 = $((6 * 7))"
echo "20 / 4 = $((20 / 4))"
echo "17 % 5 = $((17 % 5))"

# Fibonacci sequence
echo -e "\\nFibonacci sequence (first 11 numbers):"
for i in {0..10}; do
    echo -n "$(fibonacci $i) "
done
echo

# Error handling
safe_divide() {
    local a=$1
    local b=$2
    
    if [ $b -eq 0 ]; then
        echo "Error: Division by zero!" >&2
        return 1
    fi
    
    echo $((a / b))
    return 0
}

echo -e "\\nError handling:"
if result=$(safe_divide 10 2); then
    echo "10 / 2 = $result"
fi

if ! result=$(safe_divide 10 0); then
    echo "Division failed as expected"
fi

# Function with multiple return values
get_stats() {
    local -n arr=$1
    local sum=0
    local count=\${#arr[@]}
    
    for num in "\${arr[@]}"; do
        sum=$((sum + num))
    done
    
    echo $sum $count $((sum / count))
}

echo -e "\\nArray statistics:"
read -r sum count average <<< "$(get_stats numbers)"
echo "Sum: $sum, Count: $count, Average: $average"

echo -e "\\nBash sample script completed!"
echo "=================================="`
        };

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            if (sectionName === 'editor' && !monacoEditor) {
                initializeMonacoEditor();
            }
        }

        // Load sample code function
        function loadSampleCode(language) {
            if (!SAMPLE_CODES[language]) {
                showNotification(`Sample code for ${language} not available`, 'error');
                return;
            }
            
            if (monacoEditor) {
                monacoEditor.setValue(SAMPLE_CODES[language]);
                
                // Set the appropriate language in Monaco Editor
                const monacoLanguageMap = {
                    'cpp': 'cpp',
                    'csharp': 'csharp',
                    'java': 'java',
                    'python': 'python',
                    'javascript': 'javascript',
                    'typescript': 'typescript',
                    'go': 'go',
                    'rust': 'rust',
                    'php': 'php',
                    'ruby': 'ruby',
                    'swift': 'swift',
                    'kotlin': 'kotlin',
                    'sql': 'sql',
                    'r': 'r',
                    'scala': 'scala',
                    'perl': 'perl',
                    'lua': 'lua',
                    'bash': 'shell'
                };
                
                const monacoLang = monacoLanguageMap[language] || language;
                monaco.editor.setModelLanguage(monacoEditor.getModel(), monacoLang);
                document.getElementById('languageSelect').value = language;
                
                // Update current file content
                currentProject.files[currentProject.currentFile] = SAMPLE_CODES[language];
                
                // Update filename to reflect the language
                const extensions = {
                    'java': '.java',
                    'cpp': '.cpp',
                    'csharp': '.cs',
                    'go': '.go',
                    'rust': '.rs',
                    'php': '.php',
                    'ruby': '.rb',
                    'swift': '.swift',
                    'kotlin': '.kt',
                    'typescript': '.ts',
                    'sql': '.sql',
                    'r': '.r',
                    'scala': '.scala',
                    'perl': '.pl',
                    'lua': '.lua',
                    'bash': '.sh'
                };
                
                const newFilename = `sample${extensions[language] || '.txt'}`;
                document.getElementById('currentFileName').textContent = newFilename;
                currentProject.currentFile = newFilename;
                
                showNotification(`${language.toUpperCase()} sample code loaded!`, 'success');
            }
        }

        // FIXED Monaco Editor initialization with proper completion
        function initializeMonacoEditor() {
            require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
            require(['vs/editor/editor.main'], function () {
                monacoEditor = monaco.editor.create(document.getElementById('monacoEditor'), {
                    value: currentProject.files[currentProject.currentFile],
                    language: 'python',
                    theme: 'vs-dark',
                    automaticLayout: true,
                    fontSize: 14,
                    wordWrap: 'on',
                    minimap: { enabled: true },
                    scrollBeyondLastLine: false,
                    renderLineHighlight: 'line',
                    selectOnLineNumbers: true,
                    // FIXED: Enhanced completion settings
                    quickSuggestions: {
                        other: true,
                        comments: false, 
                        strings: false
                    },
                    suggestOnTriggerCharacters: true,
                    acceptSuggestionOnEnter: "on",
                    acceptSuggestionOnCommitCharacter: true,
                    tabCompletion: "on",
                    wordBasedSuggestions: "allDocuments",
                    // Parameter hints
                    parameterHints: {
                        enabled: true,
                        cycle: true
                    },
                    // Hover information
                    hover: {
                        enabled: true,
                        delay: 300,
                        sticky: true
                    },
                    // Auto-closing and formatting
                    autoClosingBrackets: 'languageDefined',
                    autoClosingQuotes: 'languageDefined',
                    autoSurround: 'languageDefined',
                    formatOnPaste: true,
                    formatOnType: true,
                    // Enhanced IntelliSense
                    suggest: {
                        filterGraceful: true,
                        snippetsPreventQuickSuggestions: false,
                        localityBonus: true,
                        shareSuggestSelections: false,
                        showIcons: true,
                        showStatusBar: true,
                        preview: true,
                        previewMode: 'prefix'
                    }
                });
                
                // Save content on change
                monacoEditor.onDidChangeModelContent(() => {
                    currentProject.files[currentProject.currentFile] = monacoEditor.getValue();
                });

                // FIXED: Proper keyboard shortcuts
                monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Space, function() {
                    triggerCompletion();
                });

                // AI completion shortcut
                monacoEditor.addCommand(monaco.KeyMod.Alt | monaco.KeyCode.Space, function() {
                    aiComplete();
                });

                // FIXED: Register completion providers immediately with Monaco ready
                registerEnhancedCompletionProviders();
                console.log('✅ Code completion and suggestions are now active!');
                showNotification('Code completion initialized! Press Ctrl+Space for suggestions.', 'success');
            });
        }

        // FIXED: Enhanced completion provider registration with improved provider logic
        function registerEnhancedCompletionProviders() {
            // FIXED: Enhanced Python completion provider
            const pythonProvider = monaco.languages.registerCompletionItemProvider('python', {
                triggerCharacters: ['.', ' ', '(', '[', '"', "'"],
                provideCompletionItems: function(model, position, context, token) {
                    const textUntilPosition = model.getValueInRange({
                        startLineNumber: position.lineNumber,
                        startColumn: 1,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column
                    });
                    
                    const word = model.getWordUntilPosition(position);
                    const range = {
                        startLineNumber: position.lineNumber,
                        endLineNumber: position.lineNumber,
                        startColumn: word.startColumn,
                        endColumn: word.endColumn
                    };

                    const suggestions = getPythonCompletions(textUntilPosition, word.word, range);
                    
                    return {
                        suggestions: suggestions
                    };
                }
            });

            // FIXED: Enhanced JavaScript completion provider
            const jsProvider = monaco.languages.registerCompletionItemProvider('javascript', {
                triggerCharacters: ['.', ' ', '(', '[', '"', "'"],
                provideCompletionItems: function(model, position, context, token) {
                    const textUntilPosition = model.getValueInRange({
                        startLineNumber: position.lineNumber,
                        startColumn: 1,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column
                    });
                    
                    const word = model.getWordUntilPosition(position);
                    const range = {
                        startLineNumber: position.lineNumber,
                        endLineNumber: position.lineNumber,
                        startColumn: word.startColumn,
                        endColumn: word.endColumn
                    };

                    const suggestions = getJavaScriptCompletions(textUntilPosition, word.word, range);
                    
                    return {
                        suggestions: suggestions
                    };
                }
            });

            // FIXED: Enhanced Java completion provider
            const javaProvider = monaco.languages.registerCompletionItemProvider('java', {
                triggerCharacters: ['.', ' ', '(', '"'],
                provideCompletionItems: function(model, position, context, token) {
                    const textUntilPosition = model.getValueInRange({
                        startLineNumber: position.lineNumber,
                        startColumn: 1,
                        endLineNumber: position.lineNumber,
                        endColumn: position.column
                    });
                    
                    const word = model.getWordUntilPosition(position);
                    const range = {
                        startLineNumber: position.lineNumber,
                        endLineNumber: position.lineNumber,
                        startColumn: word.startColumn,
                        endColumn: word.endColumn
                    };

                    const suggestions = getJavaCompletions(textUntilPosition, word.word, range);
                    
                    return {
                        suggestions: suggestions
                    };
                }
            });

            // Additional language providers
            const additionalLanguages = ['cpp', 'csharp', 'go', 'rust', 'php', 'ruby', 'swift', 'kotlin', 'typescript'];
            additionalLanguages.forEach(lang => {
                monaco.languages.registerCompletionItemProvider(lang, {
                    triggerCharacters: ['.', ' ', '('],
                    provideCompletionItems: function(model, position, context, token) {
                        const word = model.getWordUntilPosition(position);
                        const range = {
                            startLineNumber: position.lineNumber,
                            endLineNumber: position.lineNumber,
                            startColumn: word.startColumn,
                            endColumn: word.endColumn
                        };
                        return {
                            suggestions: getGenericCompletions(lang, word.word, range)
                        };
                    }
                });
            });
            
            console.log('✅ All completion providers registered successfully');
        }

        // FIXED: Enhanced completion functions with comprehensive suggestions
        function getPythonCompletions(textUntilPosition, wordText, range) {
            const suggestions = [];
            const lowerText = textUntilPosition.toLowerCase();
            const lowerWord = wordText.toLowerCase();

            // Control structures
            if (lowerWord === '' || 'if'.includes(lowerWord)) {
                suggestions.push({
                    label: 'if statement',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'if ${1:condition}:\n    ${2:pass}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'If conditional statement',
                    detail: 'Control Flow'
                });
            }

            if (lowerWord === '' || 'for'.includes(lowerWord)) {
                suggestions.push({
                    label: 'for loop',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'for ${1:item} in ${2:iterable}:\n    ${3:pass}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'For loop iteration',
                    detail: 'Control Flow'
                });
            }

            if (lowerWord === '' || 'def'.includes(lowerWord)) {
                suggestions.push({
                    label: 'def function',
                    kind: monaco.languages.CompletionItemKind.Function,
                    insertText: 'def ${1:function_name}(${2:params}):\n    """${3:Description}"""\n    ${4:return None}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Function definition with docstring',
                    detail: 'Function'
                });
            }

            if (lowerWord === '' || 'class'.includes(lowerWord)) {
                suggestions.push({
                    label: 'class definition',
                    kind: monaco.languages.CompletionItemKind.Class,
                    insertText: 'class ${1:ClassName}:\n    def __init__(self${2:, args}):\n        ${3:pass}\n    \n    def ${4:method}(self):\n        ${5:pass}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Class definition with constructor and method',
                    detail: 'Class'
                });
            }

            if (lowerWord === '' || 'try'.includes(lowerWord)) {
                suggestions.push({
                    label: 'try-except block',
                    kind: monaco.languages.CompletionItemKind.Snippet,
                    insertText: 'try:\n    ${1:# code}\nexcept ${2:Exception} as ${3:e}:\n    ${4:print(f"Error: {e}")}\nfinally:\n    ${5:# cleanup}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Try-except-finally block',
                    detail: 'Error Handling'
                });
            }

            // Python built-ins and common patterns
            const pythonBuiltins = [
                { name: 'print', snippet: 'print(${1:value})', doc: 'Print to console', detail: 'Built-in' },
                { name: 'len', snippet: 'len(${1:obj})', doc: 'Get length of object', detail: 'Built-in' },
                { name: 'range', snippet: 'range(${1:stop})', doc: 'Generate range of numbers', detail: 'Built-in' },
                { name: 'enumerate', snippet: 'enumerate(${1:iterable})', doc: 'Enumerate with index', detail: 'Built-in' },
                { name: 'zip', snippet: 'zip(${1:iterables})', doc: 'Zip iterables together', detail: 'Built-in' },
                { name: 'list', snippet: 'list(${1:iterable})', doc: 'Create list from iterable', detail: 'Built-in' },
                { name: 'dict', snippet: 'dict(${1:})', doc: 'Create dictionary', detail: 'Built-in' },
                { name: 'set', snippet: 'set(${1:iterable})', doc: 'Create set from iterable', detail: 'Built-in' },
                { name: 'str', snippet: 'str(${1:obj})', doc: 'Convert to string', detail: 'Built-in' },
                { name: 'int', snippet: 'int(${1:value})', doc: 'Convert to integer', detail: 'Built-in' },
                { name: 'float', snippet: 'float(${1:value})', doc: 'Convert to float', detail: 'Built-in' },
                { name: 'open', snippet: 'open(${1:filename}, ${2:"r"})', doc: 'Open file', detail: 'Built-in' },
                { name: 'with open', snippet: 'with open(${1:filename}, ${2:"r"}) as ${3:f}:\n    ${4:content = f.read()}', doc: 'Open file with context manager', detail: 'Pattern' }
            ];

            pythonBuiltins.forEach(builtin => {
                if (lowerWord === '' || builtin.name.toLowerCase().includes(lowerWord)) {
                    suggestions.push({
                        label: builtin.name,
                        kind: builtin.name === 'with open' ? monaco.languages.CompletionItemKind.Snippet : monaco.languages.CompletionItemKind.Function,
                        insertText: builtin.snippet,
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        range: range,
                        documentation: builtin.doc,
                        detail: builtin.detail
                    });
                }
            });

            return suggestions;
        }

        function getJavaScriptCompletions(textUntilPosition, wordText, range) {
            const suggestions = [];
            const lowerText = textUntilPosition.toLowerCase();
            const lowerWord = wordText.toLowerCase();

            // Function declarations
            if (lowerWord === '' || 'function'.includes(lowerWord)) {
                suggestions.push({
                    label: 'function declaration',
                    kind: monaco.languages.CompletionItemKind.Function,
                    insertText: 'function ${1:functionName}(${2:params}) {\n    ${3:// implementation}\n    return ${4:result};\n}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Function declaration',
                    detail: 'Function'
                });

                suggestions.push({
                    label: 'arrow function',
                    kind: monaco.languages.CompletionItemKind.Function,
                    insertText: 'const ${1:functionName} = (${2:params}) => {\n    ${3:// implementation}\n    return ${4:result};\n};',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Arrow function expression',
                    detail: 'Function'
                });
            }

            if (lowerWord === '' || 'async'.includes(lowerWord)) {
                suggestions.push({
                    label: 'async function',
                    kind: monaco.languages.CompletionItemKind.Function,
                    insertText: 'async function ${1:functionName}(${2:params}) {\n    try {\n        ${3:// async code}\n        const result = await ${4:asyncOperation()};\n        return result;\n    } catch (error) {\n        ${5:console.error(error);}\n        throw error;\n    }\n}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Async function with error handling',
                    detail: 'Async Function'
                });
            }

            if (lowerWord === '' || 'class'.includes(lowerWord)) {
                suggestions.push({
                    label: 'class definition',
                    kind: monaco.languages.CompletionItemKind.Class,
                    insertText: 'class ${1:ClassName} {\n    constructor(${2:params}) {\n        ${3:this.property = params;}\n    }\n    \n    ${4:methodName}() {\n        ${5:// method implementation}\n    }\n}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'ES6 class definition',
                    detail: 'Class'
                });
            }

            // JavaScript methods and objects
            const jsMethods = [
                { name: 'console.log', snippet: 'console.log(${1:value})', doc: 'Log to console', detail: 'Console' },
                { name: 'console.error', snippet: 'console.error(${1:error})', doc: 'Log error to console', detail: 'Console' },
                { name: 'console.warn', snippet: 'console.warn(${1:warning})', doc: 'Log warning to console', detail: 'Console' },
                { name: 'Array.from', snippet: 'Array.from(${1:arrayLike})', doc: 'Create array from array-like', detail: 'Array' },
                { name: 'Array.isArray', snippet: 'Array.isArray(${1:obj})', doc: 'Check if object is array', detail: 'Array' },
                { name: 'Object.keys', snippet: 'Object.keys(${1:obj})', doc: 'Get object keys', detail: 'Object' },
                { name: 'Object.values', snippet: 'Object.values(${1:obj})', doc: 'Get object values', detail: 'Object' },
                { name: 'Object.entries', snippet: 'Object.entries(${1:obj})', doc: 'Get object entries', detail: 'Object' },
                { name: 'JSON.stringify', snippet: 'JSON.stringify(${1:obj}, ${2:null}, ${3:2})', doc: 'Convert to JSON string', detail: 'JSON' },
                { name: 'JSON.parse', snippet: 'JSON.parse(${1:str})', doc: 'Parse JSON string', detail: 'JSON' },
                { name: 'setTimeout', snippet: 'setTimeout(() => {\n    ${2:// code}\n}, ${1:1000})', doc: 'Execute after delay', detail: 'Timer' },
                { name: 'setInterval', snippet: 'setInterval(() => {\n    ${2:// code}\n}, ${1:1000})', doc: 'Execute repeatedly', detail: 'Timer' },
                { name: 'fetch', snippet: 'fetch(${1:url})\n    .then(response => {\n        if (!response.ok) throw new Error("HTTP " + response.status);\n        return response.json();\n    })\n    .then(data => ${2:console.log(data)})\n    .catch(error => ${3:console.error(error)})', doc: 'Fetch API call', detail: 'Network' },
                { name: 'addEventListener', snippet: 'addEventListener(${1:"event"}, (${2:e}) => {\n    ${3:// handle event}\n})', doc: 'Add event listener', detail: 'Event' },
                { name: 'document.querySelector', snippet: 'document.querySelector(${1:"selector"})', doc: 'Select DOM element', detail: 'DOM' },
                { name: 'document.getElementById', snippet: 'document.getElementById(${1:"id"})', doc: 'Get element by ID', detail: 'DOM' }
            ];

            jsMethods.forEach(method => {
                if (lowerWord === '' || method.name.toLowerCase().includes(lowerWord)) {
                    suggestions.push({
                        label: method.name,
                        kind: monaco.languages.CompletionItemKind.Method,
                        insertText: method.snippet,
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        range: range,
                        documentation: method.doc,
                        detail: method.detail
                    });
                }
            });

            return suggestions;
        }

        function getJavaCompletions(textUntilPosition, wordText, range) {
            const suggestions = [];
            const lowerText = textUntilPosition.toLowerCase();
            const lowerWord = wordText.toLowerCase();

            // Java class structure
            if (lowerWord === '' || 'public class'.includes(lowerWord) || 'class'.includes(lowerWord)) {
                suggestions.push({
                    label: 'public class',
                    kind: monaco.languages.CompletionItemKind.Class,
                    insertText: 'public class ${1:ClassName} {\n    private ${2:String} ${3:field};\n    \n    public ${1:ClassName}(${4:String field}) {\n        this.${3:field} = ${4:field};\n    }\n    \n    public ${2:String} get${3/(.*)/${1:/capitalize}/}() {\n        return ${3:field};\n    }\n    \n    public void set${3/(.*)/${1:/capitalize}/}(${2:String} ${3:field}) {\n        this.${3:field} = ${3:field};\n    }\n}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Java class with getters and setters',
                    detail: 'Class'
                });
            }

            if (lowerWord === '' || 'public'.includes(lowerWord)) {
                suggestions.push({
                    label: 'public method',
                    kind: monaco.languages.CompletionItemKind.Method,
                    insertText: 'public ${1:returnType} ${2:methodName}(${3:params}) {\n    ${4:// implementation}\n    return ${5:result};\n}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Public method declaration',
                    detail: 'Method'
                });
            }

            if (lowerWord === '' || 'main'.includes(lowerWord)) {
                suggestions.push({
                    label: 'main method',
                    kind: monaco.languages.CompletionItemKind.Method,
                    insertText: 'public static void main(String[] args) {\n    ${1:// program entry point}\n}',
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    range: range,
                    documentation: 'Main method (program entry point)',
                    detail: 'Method'
                });
            }

            // Java built-ins and common patterns
            const javaMethods = [
                { name: 'System.out.println', snippet: 'System.out.println(${1:message});', doc: 'Print line to console', detail: 'System' },
                { name: 'System.out.print', snippet: 'System.out.print(${1:message});', doc: 'Print to console', detail: 'System' },
                { name: 'Scanner', snippet: 'Scanner ${1:scanner} = new Scanner(System.in);', doc: 'Create Scanner for input', detail: 'Input' },
                { name: 'ArrayList', snippet: 'ArrayList<${1:Type}> ${2:list} = new ArrayList<>();', doc: 'Create ArrayList', detail: 'Collection' },
                { name: 'HashMap', snippet: 'HashMap<${1:KeyType}, ${2:ValueType}> ${3:map} = new HashMap<>();', doc: 'Create HashMap', detail: 'Collection' },
                { name: 'try-catch', snippet: 'try {\n    ${1:// code that might throw exception}\n} catch (${2:Exception} ${3:e}) {\n    ${4:// handle exception}\n    ${3:e}.printStackTrace();\n}', doc: 'Try-catch block', detail: 'Error Handling' },
                { name: 'for loop', snippet: 'for (int ${1:i} = 0; ${1:i} < ${2:length}; ${1:i}++) {\n    ${3:// loop body}\n}', doc: 'For loop', detail: 'Control Flow' },
                { name: 'enhanced for', snippet: 'for (${1:Type} ${2:item} : ${3:collection}) {\n    ${4:// process item}\n}', doc: 'Enhanced for loop', detail: 'Control Flow' },
                { name: 'if statement', snippet: 'if (${1:condition}) {\n    ${2:// code}\n}', doc: 'If statement', detail: 'Control Flow' }
            ];

            javaMethods.forEach(method => {
                if (lowerWord === '' || method.name.toLowerCase().includes(lowerWord)) {
                    suggestions.push({
                        label: method.name,
                        kind: method.name.includes('class') ? monaco.languages.CompletionItemKind.Class : 
                              method.name.includes('method') ? monaco.languages.CompletionItemKind.Method :
                              method.name.includes('loop') || method.name.includes('if') || method.name.includes('try') ? monaco.languages.CompletionItemKind.Snippet :
                              monaco.languages.CompletionItemKind.Method,
                        insertText: method.snippet,
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        range: range,
                        documentation: method.doc,
                        detail: method.detail
                    });
                }
            });

            return suggestions;
        }

        function getGenericCompletions(language, wordText, range) {
            const suggestions = [];
            const lowerWord = wordText.toLowerCase();

            // Generic completions for other languages
            const genericPatterns = {
                'cpp': [
                    { name: '#include', snippet: '#include <${1:iostream}>', doc: 'Include header file' },
                    { name: 'std::cout', snippet: 'std::cout << ${1:value} << std::endl;', doc: 'Print to console' },
                    { name: 'std::cin', snippet: 'std::cin >> ${1:variable};', doc: 'Read from console' },
                    { name: 'int main', snippet: 'int main() {\n    ${1:// program code}\n    return 0;\n}', doc: 'Main function' }
                ],
                'go': [
                    { name: 'fmt.Println', snippet: 'fmt.Println(${1:value})', doc: 'Print to console' },
                    { name: 'func main', snippet: 'func main() {\n    ${1:// program code}\n}', doc: 'Main function' },
                    { name: 'package main', snippet: 'package main\n\nimport "fmt"', doc: 'Package declaration' }
                ],
                'rust': [
                    { name: 'println!', snippet: 'println!("${1:message}");', doc: 'Print macro' },
                    { name: 'fn main', snippet: 'fn main() {\n    ${1:// program code}\n}', doc: 'Main function' },
                    { name: 'let', snippet: 'let ${1:variable} = ${2:value};', doc: 'Variable declaration' }
                ]
            };

            const patterns = genericPatterns[language] || [];
            patterns.forEach(pattern => {
                if (lowerWord === '' || pattern.name.toLowerCase().includes(lowerWord)) {
                    suggestions.push({
                        label: pattern.name,
                        kind: monaco.languages.CompletionItemKind.Snippet,
                        insertText: pattern.snippet,
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        range: range,
                        documentation: pattern.doc
                    });
                }
            });

            return suggestions;
        }

        // FIXED: Trigger completion function with better feedback
        function triggerCompletion() {
            if (monacoEditor) {
                monacoEditor.focus();
                monacoEditor.trigger('keyboard', 'editor.action.triggerSuggest', {});
                console.log('🔥 Code completion triggered!');
                showNotification('Code suggestions triggered! Use ↑↓ keys to navigate, Enter to accept.', 'success');
            } else {
                showNotification('Please wait for the editor to fully load', 'error');
            }
        }

        function selectFile(fileName) {
            // Save current file content
            if (monacoEditor && currentProject.currentFile) {
                currentProject.files[currentProject.currentFile] = monacoEditor.getValue();
            }

            // Update UI
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('active', 'bg-blue-600');
            });
            event.target.closest('.file-item').classList.add('active', 'bg-blue-600');
            
            // Switch to new file
            currentProject.currentFile = fileName;
            document.getElementById('currentFileName').textContent = fileName;
            
            // Load file content
            if (monacoEditor) {
                monacoEditor.setValue(currentProject.files[fileName] || '');
                
                // Set language based on file extension
                const extension = fileName.split('.').pop().toLowerCase();
                const languageMap = {
                    'py': 'python', 'js': 'javascript', 'css': 'css', 'html': 'html',
                    'java': 'java', 'cpp': 'cpp', 'c': 'c', 'cs': 'csharp',
                    'go': 'go', 'rs': 'rust', 'php': 'php', 'rb': 'ruby',
                    'swift': 'swift', 'kt': 'kotlin', 'ts': 'typescript',
                    'sql': 'sql', 'r': 'r', 'scala': 'scala', 'pl': 'perl',
                    'lua': 'lua', 'sh': 'bash'
                };
                const language = languageMap[extension] || 'text';
                monaco.editor.setModelLanguage(monacoEditor.getModel(), language);
                document.getElementById('languageSelect').value = language;
            }
        }

        function createNewFile() {
            const fileName = prompt('Enter file name (e.g., app.py, style.css, script.js):');
            if (fileName && fileName.trim() && !currentProject.files[fileName]) {
                currentProject.files[fileName] = getDefaultContent(fileName);
                addFileToTree(fileName);
                selectFile(fileName);
                showNotification(`File '${fileName}' created successfully!`, 'success');
            } else if (currentProject.files[fileName]) {
                showNotification(`File '${fileName}' already exists!`, 'error');
            }
        }
        
        function createNewFolder() {
            const folderName = prompt('Enter folder name:');
            if (folderName && folderName.trim()) {
                showNotification(`Folder '${folderName}' noted (file organization coming soon!)`, 'success');
            }
        }
        
        function addFileToTree(fileName) {
            const fileTree = document.getElementById('fileTree');
            const fileItem = document.createElement('div');
            const ext = fileName.split('.').pop().toLowerCase();
            const iconClass = getFileIcon(ext);
            
            fileItem.className = 'file-item p-2 rounded flex items-center space-x-2 cursor-pointer hover:bg-gray-700';
            fileItem.onclick = () => selectFile(fileName);
            fileItem.innerHTML = `<i class="fas fa-file-code ${iconClass}"></i><span>${fileName}</span>`;
            fileTree.appendChild(fileItem);
        }
        
        function getFileIcon(extension) {
            const iconMap = {
                'py': 'text-blue-400', 'js': 'text-yellow-400', 'css': 'text-green-400',
                'html': 'text-orange-400', 'java': 'text-red-400', 'cpp': 'text-purple-400',
                'php': 'text-indigo-400', 'rb': 'text-red-500', 'go': 'text-cyan-400',
                'rs': 'text-orange-500', 'cs': 'text-purple-500', 'swift': 'text-orange-600',
                'kt': 'text-purple-600', 'ts': 'text-blue-500', 'sql': 'text-green-500',
                'r': 'text-blue-300', 'scala': 'text-red-300', 'pl': 'text-yellow-500',
                'lua': 'text-blue-200', 'sh': 'text-gray-400'
            };
            return iconMap[extension] || 'text-gray-400';
        }
        
        function getDefaultContent(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const templates = {
                'py': '# ' + fileName + '\nprint("Hello from ' + fileName + '!")',
                'js': '// ' + fileName + '\nconsole.log("Hello from ' + fileName + '!");',
                'css': '/* ' + fileName + ' */\nbody { margin: 0; padding: 20px; }',
                'html': '<!DOCTYPE html>\n<html>\n<head><title>' + fileName.replace('.html', '') + '</title></head>\n<body>\n    <h1>Hello from ' + fileName + '!</h1>\n</body>\n</html>',
                'java': 'public class ' + fileName.replace('.java', '') + ' {\n    public static void main(String[] args) {\n        System.out.println("Hello from ' + fileName + '!");\n    }\n}',
                'cpp': '#include <iostream>\nint main() {\n    std::cout << "Hello from ' + fileName + '!" << std::endl;\n    return 0;\n}',
                'go': 'package main\nimport "fmt"\nfunc main() {\n    fmt.Println("Hello from ' + fileName + '!")\n}',
                'rust': 'fn main() {\n    println!("Hello from ' + fileName + '!");\n}'
            };
            return templates[ext] || '// ' + fileName;
        }

        // Enhanced AI Feature Functions - FIXED
        async function aiComplete() {
            if (!monacoEditor) return;
            
            const code = monacoEditor.getValue();
            const position = monacoEditor.getPosition();
            const lineContent = monacoEditor.getModel().getLineContent(position.lineNumber);
            const language = document.getElementById('languageSelect').value;
            
            showAnalysisTab('suggestions');
            document.getElementById('suggestionsResults').innerHTML = 
                '<div class="text-blue-400 loading-dots">🤖 AI analyzing code for completion</div>';
            
            try {
                const completion = await generateAdvancedCompletion(language, lineContent, code, position);
                document.getElementById('suggestionsResults').innerHTML = completion;
            } catch (error) {
                document.getElementById('suggestionsResults').innerHTML = 
                    '<div class="text-red-400">AI completion service temporarily unavailable. Try using Ctrl+Space for built-in completions.</div>';
            }
        }
        
        async function aiDebug() {
            if (!monacoEditor) return;
            
            const code = monacoEditor.getValue();
            const language = document.getElementById('languageSelect').value;
            
            showAnalysisTab('debug');
            document.getElementById('debugResults').innerHTML = 
                '<div class="text-blue-400 loading-dots">🔍 AI analyzing code for issues</div>';
            
            try {
                const analysis = await generateAdvancedDebugAnalysis(language, code);
                document.getElementById('debugResults').innerHTML = analysis;
            } catch (error) {
                document.getElementById('debugResults').innerHTML = 
                    '<div class="text-red-400">Debug analysis service temporarily unavailable. Check syntax highlighting for visual cues.</div>';
            }
        }
        
        async function aiSuggest() {
            if (!monacoEditor) return;
            
            const code = monacoEditor.getValue();
            const language = document.getElementById('languageSelect').value;
            
            showAnalysisTab('suggestions');
            document.getElementById('suggestionsResults').innerHTML = 
                '<div class="text-blue-400 loading-dots">💡 AI generating improvement suggestions</div>';
            
            try {
                const suggestions = await generateAdvancedSuggestions(language, code);
                document.getElementById('suggestionsResults').innerHTML = suggestions;
            } catch (error) {
                document.getElementById('suggestionsResults').innerHTML = 
                    '<div class="text-red-400">Suggestion service temporarily unavailable. Try the AI chat for coding help!</div>';
            }
        }

        // Advanced AI Analysis Functions - ENHANCED
        async function generateAdvancedCompletion(language, currentLine, fullCode, position) {
            // Analyze context for better completions
            const context = analyzeCodeContext(language, currentLine, fullCode);
            
            let suggestions = [];
            
            // Language-specific completions
            if (language === 'python') {
                suggestions = generatePythonCompletions(currentLine, context);
            } else if (language === 'javascript' || language === 'typescript') {
                suggestions = generateJSCompletions(currentLine, context);
            } else if (language === 'java') {
                suggestions = generateJavaCompletions(currentLine, context);
            } else {
                suggestions = generateGenericCompletions(language, currentLine, context);
            }
            
            let html = '<div class="text-green-400"><strong>💡 Smart Code Completions:</strong></div>';
            
            if (suggestions.length === 0) {
                html += '<div class="text-yellow-400 mt-2">💭 No specific completions found. Try using <kbd>Ctrl+Space</kbd> for built-in suggestions!</div>';
            } else {
                suggestions.forEach((suggestion, index) => {
                    html += `
                        <div class="mt-2 p-2 bg-gray-900 rounded border-l-4 border-blue-500">
                            <div class="text-sm text-gray-300 mb-1">${suggestion.description}</div>
                            <pre class="text-green-400 text-xs font-mono">${escapeHtml(suggestion.code)}</pre>
                            <button onclick="insertCompletion('${suggestion.code.replace(/'/g, "\\'").replace(/\n/g, "\\n")}')" 
                                    class="mt-2 px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs">
                                Insert Code
                            </button>
                        </div>`;
                });
            }
            
            return html;
        }
        
        async function generateAdvancedDebugAnalysis(language, code) {
            const issues = analyzeCodeIssues(language, code);
            
            let html = '<div class="text-red-400"><strong>🔍 Code Analysis Results:</strong></div>';
            
            if (issues.length === 0) {
                html += '<div class="text-green-400 mt-2">✅ No obvious issues detected! Code looks good.</div>';
            } else {
                issues.forEach((issue, index) => {
                    const severityColor = issue.severity === 'error' ? 'text-red-400' : 
                                         issue.severity === 'warning' ? 'text-yellow-400' : 'text-blue-400';
                    
                    html += `
                        <div class="mt-2 p-2 bg-gray-900 rounded border-l-4 border-red-500">
                            <div class="${severityColor} font-semibold">${issue.severity.toUpperCase()}: ${issue.title}</div>
                            <div class="text-gray-300 text-sm mt-1">${issue.description}</div>
                            ${issue.suggestion ? `<div class="text-green-300 text-sm mt-1">💡 <strong>Fix:</strong> ${issue.suggestion}</div>` : ''}
                            ${issue.line ? `<div class="text-gray-500 text-xs mt-1">📍 Line ${issue.line}</div>` : ''}
                        </div>`;
                });
            }
            
            return html;
        }
        
        async function generateAdvancedSuggestions(language, code) {
            const suggestions = generateCodeImprovements(language, code);
            
            let html = '<div class="text-orange-400"><strong>🚀 Code Improvement Suggestions:</strong></div>';
            
            if (suggestions.length === 0) {
                html += '<div class="text-green-400 mt-2">👍 Code is well-structured! Consider adding comments for complex logic.</div>';
            } else {
                suggestions.forEach((suggestion, index) => {
                    html += `
                        <div class="mt-2 p-2 bg-gray-900 rounded border-l-4 border-orange-500">
                            <div class="text-orange-400 font-semibold">${suggestion.category}: ${suggestion.title}</div>
                            <div class="text-gray-300 text-sm mt-1">${suggestion.description}</div>
                            ${suggestion.example ? `
                                <div class="text-green-300 text-sm mt-2">
                                    <strong>💻 Example:</strong>
                                    <pre class="mt-1 text-xs font-mono bg-black p-2 rounded">${escapeHtml(suggestion.example)}</pre>
                                </div>
                            ` : ''}
                        </div>`;
                });
            }
            
            return html;
        }

        // Code Analysis Helper Functions - ENHANCED
        function analyzeCodeContext(language, currentLine, fullCode) {
            const context = {
                inFunction: false,
                inClass: false,
                inLoop: false,
                variables: [],
                functions: [],
                imports: []
            };
            
            const lines = fullCode.split('\n');
            
            // Analyze context based on language
            if (language === 'python') {
                lines.forEach(line => {
                    if (line.includes('def ')) context.inFunction = true;
                    if (line.includes('class ')) context.inClass = true;
                    if (line.includes('for ') || line.includes('while ')) context.inLoop = true;
                    if (line.includes('import ')) context.imports.push(line);
                });
            }
            
            return context;
        }
        
        function generatePythonCompletions(currentLine, context) {
            const completions = [];
            
            if (currentLine.includes('def ') || currentLine.trim() === 'def') {
                completions.push({
                    description: 'Complete function definition with docstring',
                    code: 'def function_name(param1, param2):\n    """\n    Function description\n    \n    Args:\n        param1: Description\n        param2: Description\n    \n    Returns:\n        Description of return value\n    """\n    return result'
                });
            }
            
            if (currentLine.includes('class ') || currentLine.trim() === 'class') {
                completions.push({
                    description: 'Complete class definition with methods',
                    code: 'class ClassName:\n    def __init__(self, param):\n        self.param = param\n    \n    def __str__(self):\n        return f"ClassName({self.param})"\n    \n    def method(self):\n        return self.param'
                });
            }
            
            if (currentLine.includes('for ') || currentLine.trim() === 'for') {
                completions.push({
                    description: 'Complete for loop with enumerate',
                    code: 'for index, item in enumerate(iterable):\n    print(f"Index {index}: {item}")\n    # process item'
                });
            }
            
            if (currentLine.includes('try') || currentLine.trim() === 'try') {
                completions.push({
                    description: 'Complete try-except-finally block',
                    code: 'try:\n    # code that might raise an exception\n    result = risky_operation()\nexcept SpecificException as e:\n    print(f"Specific error: {e}")\nexcept Exception as e:\n    print(f"Unexpected error: {e}")\nfinally:\n    # cleanup code\n    pass'
                });
            }
            
            return completions;
        }
        
        function generateJSCompletions(currentLine, context) {
            const completions = [];
            
            if (currentLine.includes('function') || currentLine.trim() === 'function') {
                completions.push({
                    description: 'Complete async function with error handling',
                    code: 'async function functionName(param1, param2) {\n    try {\n        // function body\n        const result = await someAsyncOperation();\n        return result;\n    } catch (error) {\n        console.error("Error in functionName:", error);\n        throw error;\n    }\n}'
                });
            }
            
            if (currentLine.includes('class') || currentLine.trim() === 'class') {
                completions.push({
                    description: 'Complete ES6 class with methods',
                    code: 'class ClassName {\n    constructor(param) {\n        this.param = param;\n    }\n    \n    // Getter method\n    get value() {\n        return this.param;\n    }\n    \n    // Setter method\n    set value(newValue) {\n        this.param = newValue;\n    }\n    \n    // Instance method\n    method() {\n        return `Value is ${this.param}`;\n    }\n    \n    // Static method\n    static create(param) {\n        return new ClassName(param);\n    }\n}'
                });
            }
            
            if (currentLine.includes('fetch') || currentLine.includes('api')) {
                completions.push({
                    description: 'Complete fetch API call with error handling',
                    code: 'async function fetchData(url) {\n    try {\n        const response = await fetch(url);\n        \n        if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        \n        const data = await response.json();\n        return data;\n    } catch (error) {\n        console.error("Fetch error:", error);\n        throw error;\n    }\n}'
                });
            }
            
            return completions;
        }
        
        function generateJavaCompletions(currentLine, context) {
            const completions = [];
            
            if (currentLine.includes('class') || currentLine.trim() === 'class') {
                completions.push({
                    description: 'Complete Java class with encapsulation',
                    code: 'public class ClassName {\n    private String field;\n    private int number;\n    \n    // Constructor\n    public ClassName(String field, int number) {\n        this.field = field;\n        this.number = number;\n    }\n    \n    // Getters\n    public String getField() {\n        return field;\n    }\n    \n    public int getNumber() {\n        return number;\n    }\n    \n    // Setters\n    public void setField(String field) {\n        this.field = field;\n    }\n    \n    public void setNumber(int number) {\n        this.number = number;\n    }\n    \n    // toString method\n    @Override\n    public String toString() {\n        return "ClassName{field=\'" + field + "\', number=" + number + "}";\n    }\n}'
                });
            }
            
            if (currentLine.includes('public') && currentLine.includes('(')) {
                completions.push({
                    description: 'Complete method with JavaDoc',
                    code: '/**\n * Method description\n * @param param1 Description of param1\n * @param param2 Description of param2\n * @return Description of return value\n * @throws Exception Description of when this exception is thrown\n */\npublic ReturnType methodName(ParamType param1, ParamType param2) throws Exception {\n    // Validate parameters\n    if (param1 == null || param2 == null) {\n        throw new IllegalArgumentException("Parameters cannot be null");\n    }\n    \n    // Method implementation\n    ReturnType result = processParams(param1, param2);\n    return result;\n}'
                });
            }
            
            return completions;
        }
        
        function generateGenericCompletions(language, currentLine, context) {
            return [
                {
                    description: 'Add comprehensive comments',
                    code: '/**\n * TODO: Implement this functionality\n * \n * Description: Add your description here\n * Author: Your Name\n * Date: ' + new Date().toISOString().split('T')[0] + '\n */\n// Add your code here'
                },
                {
                    description: 'Add debug logging',
                    code: 'console.log("DEBUG: Entering function with params:", params);\n// Your code here\nconsole.log("DEBUG: Function completed successfully");'
                }
            ];
        }
        
        function analyzeCodeIssues(language, code) {
            const issues = [];
            const lines = code.split('\n');
            
            // Common issues across languages
            lines.forEach((line, index) => {
                // Check for potential syntax issues
                if (line.includes('=') && !line.includes('==') && !line.includes('===') && !line.includes('!=') && !line.includes('<=') && !line.includes('>=') &&
                    (line.includes('if') || line.includes('while')) && !line.includes('===')){
                    issues.push({
                        severity: 'warning',
                        title: 'Possible assignment in condition',
                        description: 'Are you sure you want assignment (=) instead of comparison (==)?',
                        line: index + 1,
                        suggestion: 'Use == or === for comparison, = for assignment'
                    });
                }
                
                // Check for console.log in production code
                if (line.includes('console.log') && !line.includes('//')) {
                    issues.push({
                        severity: 'info',
                        title: 'Console.log found',
                        description: 'Remember to remove console.log statements in production code',
                        line: index + 1,
                        suggestion: 'Replace with proper logging or remove before deployment'
                    });
                }
                
                // Check for TODO comments
                if (line.includes('TODO') || line.includes('FIXME')) {
                    issues.push({
                        severity: 'info',
                        title: 'TODO/FIXME found',
                        description: 'There are incomplete tasks in your code',
                        line: index + 1,
                        suggestion: 'Complete the TODO items or remove the comments'
                    });
                }
            });
            
            // Language-specific checks
            if (language === 'python') {
                issues.push(...analyzePythonIssues(code, lines));
            } else if (language === 'javascript') {
                issues.push(...analyzeJavaScriptIssues(code, lines));
            } else if (language === 'java') {
                issues.push(...analyzeJavaIssues(code, lines));
            }
            
            return issues;
        }
        
        function analyzePythonIssues(code, lines) {
            const issues = [];
            
            lines.forEach((line, index) => {
                // Check for missing colons
                if ((line.includes('if ') || line.includes('for ') || line.includes('while ') || 
                     line.includes('def ') || line.includes('class ')) && !line.includes(':') && line.trim().length > 0) {
                    issues.push({
                        severity: 'error',
                        title: 'Missing colon',
                        description: 'Python statements like if, for, while, def, class need a colon (:) at the end',
                        line: index + 1,
                        suggestion: 'Add a colon (:) at the end of the line'
                    });
                }
                
                // Check for bare except clauses
                if (line.includes('except:')) {
                    issues.push({
                        severity: 'warning',
                        title: 'Bare except clause',
                        description: 'Catching all exceptions can hide bugs',
                        line: index + 1,
                        suggestion: 'Catch specific exceptions: except ValueError as e:'
                    });
                }
            });
            
            return issues;
        }
        
        function analyzeJavaScriptIssues(code, lines) {
            const issues = [];
            
            lines.forEach((line, index) => {
                // Check for var usage
                if (line.includes('var ') && !line.includes('//')) {
                    issues.push({
                        severity: 'warning',
                        title: 'Use of var keyword',
                        description: 'Consider using let or const instead of var for better scoping',
                        line: index + 1,
                        suggestion: 'Use const for constants, let for variables'
                    });
                }
                
                // Check for == instead of ===
                if (line.includes('==') && !line.includes('===') && !line.includes('!==')) {
                    issues.push({
                        severity: 'warning',
                        title: 'Loose equality comparison',
                        description: 'Use === for strict equality comparison',
                        line: index + 1,
                        suggestion: 'Replace == with === and != with !=='
                    });
                }
            });
            
            return issues;
        }
        
        function analyzeJavaIssues(code, lines) {
            const issues = [];
            
            lines.forEach((line, index) => {
                // Check for missing access modifiers
                if ((line.includes('class ') || line.includes('interface ')) && !line.includes('public') && !line.includes('private') && !line.includes('protected')) {
                    issues.push({
                        severity: 'warning',
                        title: 'Missing access modifier',
                        description: 'Consider adding public, private, or protected modifier',
                        line: index + 1,
                        suggestion: 'Add appropriate access modifier (public, private, protected)'
                    });
                }
            });
            
            return issues;
        }
        
        function generateCodeImprovements(language, code) {
            const improvements = [];
            
            // Generic improvements
            if (!code.includes('//') && !code.includes('#') && !code.includes('/*') && code.length > 50) {
                improvements.push({
                    category: 'Documentation',
                    title: 'Add comments and documentation',
                    description: 'Consider adding comments to explain complex logic and document your functions',
                    example: '// This function calculates the fibonacci sequence\n// using dynamic programming for better performance\nfunction fibonacci(n) {\n    // Base cases\n    if (n <= 1) return n;\n    // Your implementation here\n}'
                });
            }
            
            if (code.length > 500 && !code.includes('function') && !code.includes('def') && !code.includes('class')) {
                improvements.push({
                    category: 'Structure',
                    title: 'Break into smaller functions',
                    description: 'Consider breaking large code blocks into smaller, reusable functions for better maintainability',
                    example: 'function calculateTotal(items) {\n    return items.reduce((sum, item) => sum + item.price, 0);\n}\n\nfunction applyDiscount(total, discountPercent) {\n    return total * (1 - discountPercent / 100);\n}'
                });
            }
            
            // Language-specific improvements
            if (language === 'python') {
                if (!code.includes('"""') && code.includes('def ')) {
                    improvements.push({
                        category: 'Documentation',
                        title: 'Add docstrings to functions',
                        description: 'Python functions should have docstrings that describe their purpose, parameters, and return values',
                        example: 'def calculate_area(radius):\n    """\n    Calculate the area of a circle.\n    \n    Args:\n        radius (float): The radius of the circle\n    \n    Returns:\n        float: The area of the circle\n    \n    Raises:\n        ValueError: If radius is negative\n    """\n    if radius < 0:\n        raise ValueError("Radius cannot be negative")\n    return 3.14159 * radius ** 2'
                    });
                }
                
                if (code.includes('except:')) {
                    improvements.push({
                        category: 'Error Handling',
                        title: 'Use specific exception handling',
                        description: 'Avoid bare except clauses, catch specific exceptions instead',
                        example: 'try:\n    result = risky_operation()\nexcept ValueError as e:\n    handle_value_error(e)\nexcept FileNotFoundError as e:\n    handle_file_error(e)\nexcept Exception as e:\n    logger.error(f"Unexpected error: {e}")\n    raise'
                    });
                }
            }
            
            if (language === 'javascript') {
                if (code.includes('var ')) {
                    improvements.push({
                        category: 'Modern Syntax',
                        title: 'Use const/let instead of var',
                        description: 'Use const for constants and let for variables to avoid hoisting issues and improve code clarity',
                        example: 'const API_URL = "https://api.example.com";\nlet counter = 0;\nconst users = [];\n\n// Instead of:\n// var API_URL = "https://api.example.com";\n// var counter = 0;\n// var users = [];'
                    });
                }
                
                if (code.includes('function(') && !code.includes('=>') && code.length > 200) {
                    improvements.push({
                        category: 'Modern Syntax',
                        title: 'Consider using arrow functions',
                        description: 'Arrow functions provide cleaner syntax and lexical this binding',
                        example: '// Arrow functions for short operations\nconst add = (a, b) => a + b;\nconst users = data.map(user => ({ ...user, active: true }));\n\n// Traditional functions for methods and complex logic\nfunction calculateTotal(items) {\n    return items.reduce((sum, item) => sum + item.price, 0);\n}'
                    });
                }
                
                if (!code.includes('async') && code.includes('fetch')) {
                    improvements.push({
                        category: 'Async/Await',
                        title: 'Use async/await for better error handling',
                        description: 'Async/await provides cleaner syntax for handling promises',
                        example: 'async function fetchUserData(userId) {\n    try {\n        const response = await fetch(`/api/users/${userId}`);\n        if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const userData = await response.json();\n        return userData;\n    } catch (error) {\n        console.error("Failed to fetch user data:", error);\n        throw error;\n    }\n}'
                    });
                }
            }
            
            if (language === 'java') {
                if (!code.includes('@Override') && code.includes('toString')) {
                    improvements.push({
                        category: 'Best Practices',
                        title: 'Use @Override annotation',
                        description: 'Always use @Override when overriding methods to catch errors at compile time',
                        example: '@Override\npublic String toString() {\n    return "User{name=\'" + name + "\', age=" + age + "}";\n}\n\n@Override\npublic boolean equals(Object obj) {\n    if (this == obj) return true;\n    if (obj == null || getClass() != obj.getClass()) return false;\n    User user = (User) obj;\n    return age == user.age && Objects.equals(name, user.name);\n}'
                    });
                }
            }
            
            return improvements;
        }
        
        function showAnalysisTab(tabName) {
            // Hide all panels
            document.querySelectorAll('.analysis-panel').forEach(panel => panel.classList.add('hidden'));
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.classList.remove('bg-green-600', 'bg-red-600', 'bg-orange-600');
                tab.classList.add('bg-gray-600');
            });
            
            // Show selected panel
            document.getElementById(tabName + 'Panel').classList.remove('hidden');
            const tab = document.getElementById(tabName + 'Tab');
            const colors = { output: 'bg-green-600', debug: 'bg-red-600', suggestions: 'bg-orange-600' };
            tab.classList.remove('bg-gray-600');
            tab.classList.add(colors[tabName] || 'bg-blue-600');
        }
        
        function saveFile() {
            if (monacoEditor && currentProject.currentFile) {
                currentProject.files[currentProject.currentFile] = monacoEditor.getValue();
                showNotification(`File '${currentProject.currentFile}' saved successfully!`, 'success');
            }
        }
        
        function exportProject() {
            const projectData = JSON.stringify(currentProject.files, null, 2);
            const blob = new Blob([projectData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ai-coder-project.json';
            a.click();
            
            URL.revokeObjectURL(url);
            showNotification('Project exported successfully!', 'success');
        }
        
        function changeLanguage() {
            if (!monacoEditor) return;
            const language = document.getElementById('languageSelect').value;
            monaco.editor.setModelLanguage(monacoEditor.getModel(), language);
        }
        
        function insertCompletion(completion) {
            if (!monacoEditor) return;
            const position = monacoEditor.getPosition();
            const range = new monaco.Range(
                position.lineNumber,
                position.column,
                position.lineNumber,
                position.column
            );
            monacoEditor.executeEdits('ai-completion', [{
                range: range,
                text: completion.replace(/\\n/g, '\n').replace(/\\'/g, "'")
            }]);
            monacoEditor.focus();
            showNotification('Code inserted successfully!', 'success');
        }
        
        function runCode() {
            const code = monacoEditor.getValue();
            const language = document.getElementById('languageSelect').value;
            
            showAnalysisTab('output');
            
            // Save the current file
            currentProject.files[currentProject.currentFile] = code;
            
            // Execute based on language with enhanced output
            if (language === 'python') {
                simulateEnhancedPythonExecution(code);
            } else if (language === 'javascript') {
                simulateEnhancedJavaScriptExecution(code);
            } else if (language === 'java') {
                simulateJavaExecution(code);
            } else if (language === 'cpp') {
                simulateCppExecution(code);
            } else if (language === 'go') {
                simulateGoExecution(code);
            } else if (language === 'rust') {
                simulateRustExecution(code);
            } else if (language === 'html') {
                simulateHtmlExecution(code);
            } else if (language === 'css') {
                simulateCssExecution(code);
            } else {
                simulateGenericExecution(language, code);
            }
        }

        // Enhanced execution simulators
        function simulateEnhancedPythonExecution(code) {
            const output = document.getElementById('codeOutput');
            const results = [];
            
            try {
                // Extract and execute print statements
                const printMatches = code.match(/print\([^)]+\)/g);
                if (printMatches) {
                    printMatches.forEach(match => {
                        let content = match.replace('print(', '').replace(/\)$/, '');
                        content = content.replace(/['"]/g, '');
                        
                        // Handle f-strings
                        content = content.replace(/f['"]([^'"]*)['"]/g, '$1');
                        content = content.replace(/\{([^}]+)\}/g, (match, variable) => {
                            // Simple variable replacement
                            return '<span class="text-yellow-400">[' + variable + ']</span>';
                        });
                        
                        results.push(content);
                    });
                }
                
                // Check for function definitions
                if (code.includes('def ')) {
                    const funcMatches = code.match(/def\s+(\w+)\s*\(/g);
                    if (funcMatches) {
                        funcMatches.forEach(match => {
                            const funcName = match.replace('def ', '').replace('(', '');
                            results.push(`<span class="text-blue-400">✓ Function '${funcName}' defined</span>`);
                        });
                    }
                }
                
                // Check for class definitions
                if (code.includes('class ')) {
                    const classMatches = code.match(/class\s+(\w+)/g);
                    if (classMatches) {
                        classMatches.forEach(match => {
                            const className = match.replace('class ', '');
                            results.push(`<span class="text-purple-400">✓ Class '${className}' defined</span>`);
                        });
                    }
                }
                
                if (results.length > 0) {
                    output.innerHTML = results.join('<br>');
                } else {
                    output.innerHTML = '<div class="text-green-400">✓ Python code executed successfully</div>';
                }
                
            } catch (error) {
                output.innerHTML = `<div class="text-red-400">Python Error: ${error.message}</div>`;
            }
        }

        function simulateEnhancedJavaScriptExecution(code) {
            const output = document.getElementById('codeOutput');
            const results = [];
            
            try {
                // Look for console.log statements
                const logMatches = code.match(/console\.log\([^)]+\)/g);
                if (logMatches) {
                    logMatches.forEach(match => {
                        let content = match.replace('console.log(', '').replace(/\)$/, '');
                        content = content.replace(/['"]/g, '');
                        content = content.replace(/`([^`]*)`/g, '$1');
                        content = content.replace(/\$\{([^}]+)\}/g, (match, variable) => {
                            return '<span class="text-yellow-400">[' + variable + ']</span>';
                        });
                        results.push(content);
                    });
                }
                
                // Check for function definitions
                const funcMatches = code.match(/function\s+(\w+)\s*\(/g);
                if (funcMatches) {
                    funcMatches.forEach(match => {
                        const funcName = match.replace('function ', '').replace('(', '');
                        results.push(`<span class="text-blue-400">✓ Function '${funcName}' defined</span>`);
                    });
                }
                
                // Check for arrow functions
                const arrowMatches = code.match(/const\s+(\w+)\s*=\s*\([^)]*\)\s*=>/g);
                if (arrowMatches) {
                    arrowMatches.forEach(match => {
                        const funcName = match.match(/const\s+(\w+)/)[1];
                        results.push(`<span class="text-cyan-400">✓ Arrow function '${funcName}' defined</span>`);
                    });
                }
                
                // Check for class definitions
                const classMatches = code.match(/class\s+(\w+)/g);
                if (classMatches) {
                    classMatches.forEach(match => {
                        const className = match.replace('class ', '');
                        results.push(`<span class="text-purple-400">✓ Class '${className}' defined</span>`);
                    });
                }
                
                if (results.length > 0) {
                    output.innerHTML = results.join('<br>');
                } else {
                    output.innerHTML = '<div class="text-green-400">✓ JavaScript executed successfully</div>';
                }
                
            } catch (error) {
                output.innerHTML = `<div class="text-red-400">JavaScript Error: ${error.message}</div>`;
            }
        }

        function simulateJavaExecution(code) {
            const output = document.getElementById('codeOutput');
            const results = [];
            
            // Extract class names
            const classMatch = code.match(/public\s+class\s+(\w+)/);
            if (classMatch) {
                results.push(`<span class="text-blue-400">✓ Compiled class: ${classMatch[1]}</span>`);
            }
            
            // Extract method names
            const methodMatches = code.match(/public\s+\w+\s+(\w+)\s*\(/g);
            if (methodMatches) {
                methodMatches.forEach(match => {
                    const methodName = match.match(/public\s+\w+\s+(\w+)/)[1];
                    if (methodName !== 'class') {
                        results.push(`<span class="text-cyan-400">✓ Method '${methodName}' defined</span>`);
                    }
                });
            }
            
            // Extract System.out.println statements
            const printMatches = code.match(/System\.out\.println\([^)]+\)/g);
            if (printMatches) {
                printMatches.forEach(match => {
                    let content = match.replace('System.out.println(', '').replace(/\)$/, '');
                    content = content.replace(/"/g, '');
                    results.push(`<span class="text-green-400">${content}</span>`);
                });
            }
            
            if (results.length > 0) {
                output.innerHTML = results.join('<br>');
            } else {
                output.innerHTML = '<div class="text-green-400">✓ Java code compiled successfully</div>';
            }
        }

        function simulateCppExecution(code) {
            const output = document.getElementById('codeOutput');
            const results = [];
            
            // Extract cout statements
            const coutMatches = code.match(/std::cout\s*<<[^;]+/g);
            if (coutMatches) {
                coutMatches.forEach(match => {
                    let content = match.replace('std::cout <<', '').replace(/"/g, '').trim();
                    if (content !== 'std::endl') {
                        results.push(`<span class="text-green-400">${content}</span>`);
                    }
                });
            }
            
            // Check for class definitions
            const classMatches = code.match(/class\s+(\w+)/g);
            if (classMatches) {
                classMatches.forEach(match => {
                    const className = match.replace('class ', '');
                    results.push(`<span class="text-purple-400">✓ Class '${className}' defined</span>`);
                });
            }
            
            // Check for function definitions
            const funcMatches = code.match(/\w+\s+\w+\s*\([^)]*\)\s*{/g);
            if (funcMatches && !code.includes('main')) {
                results.push(`<span class="text-blue-400">✓ Functions defined</span>`);
            }
            
            if (results.length > 0) {
                output.innerHTML = results.join('<br>');
            } else {
                output.innerHTML = '<div class="text-green-400">✓ C++ code compiled and executed successfully</div>';
            }
        }

        function simulateGoExecution(code) {
            const output = document.getElementById('codeOutput');
            const results = [];
            
            // Extract fmt.Println statements
            const printMatches = code.match(/fmt\.Print[ln]*\([^)]+\)/g);
            if (printMatches) {
                printMatches.forEach(match => {
                    let content = match.replace(/fmt\.Print[ln]*\(/, '').replace(/\)$/, '');
                    content = content.replace(/"/g, '');
                    results.push(`<span class="text-green-400">${content}</span>`);
                });
            }
            
            // Check for struct definitions
            const structMatches = code.match(/type\s+(\w+)\s+struct/g);
            if (structMatches) {
                structMatches.forEach(match => {
                    const structName = match.match(/type\s+(\w+)/)[1];
                    results.push(`<span class="text-purple-400">✓ Struct '${structName}' defined</span>`);
                });
            }
            
            // Check for function definitions
            const funcMatches = code.match(/func\s+(\w+)\s*\(/g);
            if (funcMatches) {
                funcMatches.forEach(match => {
                    const funcName = match.match(/func\s+(\w+)/)[1];
                    if (funcName !== 'main') {
                        results.push(`<span class="text-blue-400">✓ Function '${funcName}' defined</span>`);
                    }
                });
            }
            
            if (results.length > 0) {
                output.innerHTML = results.join('<br>');
            } else {
                output.innerHTML = '<div class="text-green-400">✓ Go code compiled and executed successfully</div>';
            }
        }

        function simulateRustExecution(code) {
            const output = document.getElementById('codeOutput');
            const results = [];
            
            // Extract println! macro calls
            const printMatches = code.match(/println!\([^)]+\)/g);
            if (printMatches) {
                printMatches.forEach(match => {
                    let content = match.replace('println!(', '').replace(/\)$/, '');
                    content = content.replace(/"/g, '');
                    results.push(`<span class="text-green-400">${content}</span>`);
                });
            }
            
            // Check for struct definitions
            const structMatches = code.match(/struct\s+(\w+)/g);
            if (structMatches) {
                structMatches.forEach(match => {
                    const structName = match.replace('struct ', '');
                    results.push(`<span class="text-purple-400">✓ Struct '${structName}' defined</span>`);
                });
            }
            
            // Check for function definitions
            const funcMatches = code.match(/fn\s+(\w+)\s*\(/g);
            if (funcMatches) {
                funcMatches.forEach(match => {
                    const funcName = match.match(/fn\s+(\w+)/)[1];
                    if (funcName !== 'main') {
                        results.push(`<span class="text-blue-400">✓ Function '${funcName}' defined</span>`);
                    }
                });
            }
            
            if (results.length > 0) {
                output.innerHTML = results.join('<br>');
            } else {
                output.innerHTML = '<div class="text-green-400">✓ Rust code compiled and executed successfully</div>';
            }
        }
        
        function simulateHtmlExecution(code) {
            const output = document.getElementById('codeOutput');
            
            if (code.trim()) {
                try {
                    // Create a sandboxed iframe for HTML preview
                    const iframe = document.createElement('iframe');
                    iframe.style.width = '100%';
                    iframe.style.height = '250px';
                    iframe.style.border = '1px solid #374151';
                    iframe.style.borderRadius = '8px';
                    iframe.style.backgroundColor = 'white';
                    iframe.sandbox = 'allow-same-origin';
                    
                    output.innerHTML = '';
                    output.appendChild(iframe);
                    
                    // Sanitize and render HTML safely
                    const sanitizedCode = code.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '<!-- Script removed for security -->');
                    
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    iframeDoc.open();
                    iframeDoc.write(sanitizedCode);
                    iframeDoc.close();
                    
                    // Add indicator
                    const indicator = document.createElement('div');
                    indicator.className = 'text-green-400 text-sm mt-2';
                    indicator.textContent = '✓ HTML rendered above (scripts removed for security)';
                    output.appendChild(indicator);
                } catch (error) {
                    output.innerHTML = `<div class="text-red-400">HTML Error: Failed to render HTML safely</div>`;
                }
            } else {
                output.innerHTML = '<div class="text-gray-400">No HTML content to display</div>';
            }
        }
        
        function simulateCssExecution(code) {
            const output = document.getElementById('codeOutput');
            
            if (code.trim()) {
                const cssRules = code.match(/([^{]+)\s*\{([^}]+)\}/g);
                const results = [];
                
                if (cssRules) {
                    results.push('<span class="text-cyan-400">✓ CSS Rules Detected:</span>');
                    cssRules.forEach((rule, index) => {
                        const selector = rule.split('{')[0].trim();
                        const properties = rule.split('{')[1].split('}')[0].split(';').filter(p => p.trim());
                        results.push(`<span class="text-blue-400">${index + 1}. ${selector}</span>`);
                        properties.forEach(prop => {
                            if (prop.trim()) {
                                results.push(`<span class="text-gray-300">   ${prop.trim()}</span>`);
                            }
                        });
                    });
                    
                    output.innerHTML = results.join('<br>');
                } else {
                    output.innerHTML = '<div class="text-yellow-400">CSS code detected but no complete rules found</div>';
                }
            } else {
                output.innerHTML = '<div class="text-gray-400">No CSS content to analyze</div>';
            }
        }
        
        function simulateGenericExecution(language, code) {
            const output = document.getElementById('codeOutput');
            const languageMessages = {
                'csharp': 'C# code compiled successfully',
                'php': 'PHP code executed successfully',
                'ruby': 'Ruby code executed successfully',
                'swift': 'Swift code compiled successfully',
                'kotlin': 'Kotlin code compiled successfully',
                'sql': 'SQL queries processed successfully',
                'r': 'R script executed successfully',
                'scala': 'Scala code compiled successfully',
                'perl': 'Perl script executed successfully',
                'lua': 'Lua script executed successfully',
                'bash': 'Bash script executed successfully'
            };
            
            const message = languageMessages[language] || `${language} code processed successfully`;
            
            // Try to extract some meaningful output based on common patterns
            let additionalOutput = '';
            if (code.includes('print') || code.includes('echo') || code.includes('puts')) {
                additionalOutput = '<br><span class="text-gray-300">Output statements detected</span>';
            }
            
            output.innerHTML = `<div class="text-green-400">✓ ${message}${additionalOutput}</div>`;
        }

        // Real AI Chat System using Transformers.js - FIXED
        let aiModel = null;
        let modelLoading = false;
        
        async function initializeAI() {
            if (aiModel || modelLoading) return;
            
            modelLoading = true;
            updateStatus('🔄 Initializing AI assistant...');
            
            try {
                // Use a very lightweight, reliable model specifically for coding
                aiModel = await window.transformers.pipeline('text2text-generation', 'Xenova/flan-t5-small', {
                    quantized: true,
                    device: 'cpu',
                    progress_callback: (progress) => {
                        if (progress.status === 'downloading') {
                            const percent = Math.round(progress.progress || 0);
                            updateStatus(`📥 Downloading AI model: ${percent}%`);
                        } else if (progress.status === 'loading') {
                            updateStatus('⚙️ Loading AI model into memory...');
                        }
                    }
                });
                updateStatus('✅ AI assistant ready!');
                console.log('AI model loaded successfully');
                return true;
            } catch (error) {
                console.error('AI model loading failed:', error);
                // Try an even smaller backup model
                try {
                    updateStatus('🔄 Trying backup AI model...');
                    aiModel = await window.transformers.pipeline('text-classification', 'Xenova/distilbert-base-uncased-finetuned-sst-2-english', {
                        quantized: true,
                        device: 'cpu'
                    });
                    aiModel = 'simple'; // Mark as simple model
                    updateStatus('✅ Lightweight AI ready!');
                    return true;
                } catch (backupError) {
                    console.error('Backup model also failed:', backupError);
                    updateStatus('✅ Smart assistant ready'); // FIXED: Removed "offline mode"
                    aiModel = 'offline';
                    return true;
                }
            } finally {
                modelLoading = false;
            }
        }
        
        function updateStatus(message) {
            const statusEl = document.getElementById('connectionStatus');
            if (statusEl) statusEl.textContent = message;
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            showTypingIndicator();
            
            try {
                // Initialize AI if not already done
                if (!aiModel && !modelLoading) {
                    await initializeAI();
                }
                
                const response = await generateRealAIResponse(message);
                hideTypingIndicator();
                addChatMessage(response, 'ai');
            } catch (error) {
                hideTypingIndicator();
                console.error('AI response error:', error);
                addChatMessage('I encountered an error generating a response. Please try again!', 'ai');
            }
        }

        async function generateRealAIResponse(message) {
            try {
                if (!aiModel) {
                    return "AI assistant is initializing. Please try again in a moment.";
                }
                
                // Handle different model types
                if (aiModel === 'offline' || aiModel === 'simple') {
                    return generateIntelligentFallback(message);
                }
                
                const lowerMessage = message.toLowerCase();
                let prompt;
                
                // Create focused prompts for the T5 model
                if (lowerMessage.includes('code') || lowerMessage.includes('function') || lowerMessage.includes('create')) {
                    prompt = `Generate code: ${message}`;
                } else if (lowerMessage.includes('explain') || lowerMessage.includes('what is') || lowerMessage.includes('how')) {
                    prompt = `Explain: ${message}`;
                } else if (lowerMessage.includes('debug') || lowerMessage.includes('error') || lowerMessage.includes('fix')) {
                    prompt = `Debug help: ${message}`;
                } else {
                    prompt = `Help with coding: ${message}`;
                }
                
                // Generate response with timeout protection
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Response timeout')), 10000)
                );
                
                const responsePromise = aiModel(prompt, {
                    max_length: 200,
                    temperature: 0.7,
                    do_sample: true,
                    top_k: 50,
                    top_p: 0.9
                });
                
                const result = await Promise.race([responsePromise, timeoutPromise]);
                
                // Extract generated text
                let response = '';
                if (result && result.length > 0) {
                    response = result[0].generated_text || result[0].text || '';
                }
                
                // Clean and validate response
                if (response && response.length > 15 && !response.includes('undefined')) {
                    // Clean up the response
                    response = response.replace(prompt, '').trim();
                    response = response.replace(/^[:\-\s]+/, '').trim();
                    
                    // Add code formatting if needed
                    if (lowerMessage.includes('function') || lowerMessage.includes('code')) {
                        if (!response.includes('```') && (response.includes('def ') || response.includes('function '))) {
                            const lang = response.includes('def ') ? 'python' : 'javascript';
                            response = `Here's the code:\n\n\`\`\`${lang}\n${response}\n\`\`\``;
                        }
                    }
                    
                    return response;
                } else {
                    return generateIntelligentFallback(message);
                }
                
            } catch (error) {
                console.error('AI response error:', error);
                return generateIntelligentFallback(message);
            }
        }
        
        function generateIntelligentFallback(message) {
            const lowerMessage = message.toLowerCase();
            
            // Fixed: More specific language matching to avoid the "r" issue
            const languageKeywords = {
                'java programming': 'java',
                'java code': 'java',
                'cpp': 'cpp',
                'c++': 'cpp',
                'c plus plus': 'cpp',
                'c sharp': 'csharp',
                'c#': 'csharp',
                'go programming': 'go',
                'golang': 'go',
                'rust programming': 'rust',
                'rust code': 'rust',
                'php code': 'php',
                'php programming': 'php',
                'ruby code': 'ruby',
                'ruby programming': 'ruby',
                'swift code': 'swift',
                'swift programming': 'swift',
                'kotlin code': 'kotlin',
                'kotlin programming': 'kotlin',
                'typescript': 'typescript',
                'sql query': 'sql',
                'sql code': 'sql',
                'database': 'sql',
                'r programming': 'r',
                'r language': 'r',
                'r statistical': 'r',
                'scala code': 'scala',
                'scala programming': 'scala',
                'perl script': 'perl',
                'perl code': 'perl',
                'lua script': 'lua',
                'lua code': 'lua',
                'bash script': 'bash',
                'shell script': 'bash'
            };

            // Check for specific language requests
            for (const [keyword, lang] of Object.entries(languageKeywords)) {
                if (lowerMessage.includes(keyword)) {
                    if (SAMPLE_CODES[lang]) {
                        return `Here's a ${lang.toUpperCase()} sample:\n\n\`\`\`${lang}\n${SAMPLE_CODES[lang].substring(0, 300)}...\n\`\`\`\n\nYou can also click the "${lang.toUpperCase()}" button in the sample codes section!`;
                    }
                }
            }
            
            if (lowerMessage.includes('function') || lowerMessage.includes('create')) {
                if (lowerMessage.includes('python')) {
                    return `Here's a Python function template:\n\n\`\`\`python\ndef my_function(param1, param2):\n    \"\"\"\n    ${message}\n    \"\"\"\n    # Implementation here\n    result = param1 + param2\n    return result\n\n# Usage\nresult = my_function(5, 3)\nprint(result)\n\`\`\``;
                } else if (lowerMessage.includes('javascript') || lowerMessage.includes('js')) {
                    return `Here's a JavaScript function:\n\n\`\`\`javascript\nfunction myFunction(param1, param2) {\n    // ${message}\n    const result = param1 + param2;\n    return result;\n}\n\n// Usage\nconst result = myFunction(5, 3);\nconsole.log(result);\n\`\`\``;
                } else if (lowerMessage.includes('java')) {
                    return `Here's a Java method:\n\n\`\`\`java\npublic class MyClass {\n    public static int myMethod(int param1, int param2) {\n        // ${message}\n        return param1 + param2;\n    }\n    \n    public static void main(String[] args) {\n        int result = myMethod(5, 3);\n        System.out.println(result);\n    }\n}\n\`\`\``;
                }
            }
            
            if (lowerMessage.includes('html') || lowerMessage.includes('web') || lowerMessage.includes('page')) {
                return `HTML template:\n\n\`\`\`html\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>My Page</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            margin: 20px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n        .container {\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <h1>Welcome!</h1>\n        <p>Your content here</p>\n        <button onclick="alert('Hello!')">Click me</button>\n    </div>\n</body>\n</html>\n\`\`\``;
            }
            
            if (lowerMessage.includes('debug') || lowerMessage.includes('error') || lowerMessage.includes('fix')) {
                return `To help debug your code:\n\n🔍 **Debugging Steps:**\n1. Share the code that's causing issues\n2. Describe what you expected vs what happened\n3. Include any error messages you're seeing\n\n💡 **Common Issues:**\n- **Syntax errors**: Missing semicolons, brackets, or colons\n- **Logic errors**: Incorrect conditions or calculations\n- **Runtime errors**: Division by zero, undefined variables\n- **Type errors**: Wrong data types\n\n📋 **Quick Debug Tips:**\n- Add console.log() or print() statements\n- Check variable values at different points\n- Verify function parameters and return values\n- Use the Debug tab in this editor for AI analysis!\n\nPaste your code and I'll help identify the problem!`;
            }
            
            if (lowerMessage.includes('best practices') || lowerMessage.includes('tips')) {
                return `🌟 **Coding Best Practices:**\n\n📝 **Code Quality:**\n- Use meaningful variable and function names\n- Write comments for complex logic\n- Keep functions small and focused\n- Follow consistent indentation\n\n🔧 **Performance:**\n- Avoid nested loops when possible\n- Use appropriate data structures\n- Minimize memory usage\n- Optimize algorithms\n\n🛡️ **Security:**\n- Validate user input\n- Use secure coding practices\n- Keep dependencies updated\n- Handle errors gracefully\n\n📚 **Organization:**\n- Structure code in logical modules\n- Use version control (Git)\n- Write unit tests\n- Document your API\n\nWhich language are you working with? I can give more specific advice!`;
            }
            
            if (lowerMessage.includes('algorithm') || lowerMessage.includes('data structure')) {
                return `🧠 **Common Algorithms & Data Structures:**\n\n🔍 **Search Algorithms:**\n- Linear Search: O(n)\n- Binary Search: O(log n)\n- Hash Table Lookup: O(1) average\n\n📊 **Sorting Algorithms:**\n- Bubble Sort: O(n²)\n- Merge Sort: O(n log n)\n- Quick Sort: O(n log n) average\n\n🗂️ **Data Structures:**\n- **Array**: Fast access, fixed size\n- **Linked List**: Dynamic size, slower access\n- **Stack**: LIFO (Last In, First Out)\n- **Queue**: FIFO (First In, First Out)\n- **Tree**: Hierarchical data\n- **Hash Map**: Key-value pairs\n\nNeed help implementing any of these? Just ask!`;
            }
            
            return `I'm here to help with coding! I can:\n\n💻 **Generate Code:**\n- Functions in any language\n- Complete programs\n- HTML/CSS layouts\n- Database queries\n\n🔍 **Debug & Fix:**\n- Find syntax errors\n- Logic problems\n- Performance issues\n- Security vulnerabilities\n\n📚 **Explain Concepts:**\n- Programming fundamentals\n- Algorithms and data structures\n- Best practices\n- Language-specific features\n\n🛠️ **Quick Actions:**\n- Use the sample code buttons for ${Object.keys(SAMPLE_CODES).join(', ')}\n- Try the Debug/Suggest buttons in the editor\n- Run your code to see real-time output\n\nWhat coding challenge can I help you tackle?`;
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex items-start space-x-3';
            
            const isUser = sender === 'user';
            const avatarClass = isUser ? 'bg-blue-600' : 'bg-purple-600';
            const icon = isUser ? 'fas fa-user' : 'fas fa-robot';
            
            // Process code blocks
            const processedMessage = message.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                return `<div class="mt-3 bg-gray-900 rounded-lg p-3 overflow-x-auto">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs text-gray-400">${lang || 'code'}</span>
                        <button onclick="copyToEditor(\`${code.replace(/`/g, "\\`").replace(/\n/g, "\\n")}\`, '${lang || 'python'}')" 
                                class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded">
                            Copy to Editor
                        </button>
                    </div>
                    <pre class="text-sm text-green-400"><code>${escapeHtml(code)}</code></pre>
                </div>`;
            });
            
            // Process inline code
            const finalMessage = processedMessage.replace(/`([^`]+)`/g, '<code class="bg-gray-900 px-1 rounded text-sm text-green-400">$1</code>');
            
            messageDiv.innerHTML = `
                <div class="w-8 h-8 ${avatarClass} rounded-full flex items-center justify-center">
                    <i class="${icon} text-sm"></i>
                </div>
                <div class="flex-1 bg-gray-700 rounded-lg p-3">
                    ${finalMessage.replace(/\n/g, '<br>')}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'chat-message flex items-start space-x-3';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-robot text-sm"></i>
                </div>
                <div class="flex-1 bg-gray-700 rounded-lg p-3">
                    <div class="typing-indicator active">🤖 Thinking<span class="loading-dots">...</span></div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function copyToEditor(code, language) {
            if (monacoEditor) {
                monacoEditor.setValue(code);
                
                // Set the language in Monaco and dropdown
                const languageMap = {
                    'python': 'python',
                    'javascript': 'javascript',
                    'java': 'java',
                    'cpp': 'cpp',
                    'html': 'html',
                    'css': 'css',
                    'go': 'go',
                    'rust': 'rust'
                };
                
                const monacoLang = languageMap[language] || language;
                monaco.editor.setModelLanguage(monacoEditor.getModel(), monacoLang);
                document.getElementById('languageSelect').value = language;
                
                currentProject.files[currentProject.currentFile] = code;
                showSection('editor');
                showNotification('Code copied to editor!', 'success');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 transition-all duration-300 ${
                type === 'success' ? 'bg-green-600' : 'bg-red-600'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Rotating code examples for hero section
        const codeExamples = [
            {
                language: 'JavaScript',
                code: `<div><span class="comment">// AI-Powered Code Generation</span></div>
<div><span class="keyword">function</span> <span class="function">createApp</span>() {</div>
<div>&nbsp;&nbsp;<span class="keyword">const</span> ai = <span class="keyword">new</span> <span class="function">AIAssistant</span>();</div>
<div>&nbsp;&nbsp;ai.<span class="function">generateCode</span>(<span class="string">"calculator"</span>);</div>
<div>&nbsp;&nbsp;ai.<span class="function">optimize</span>();</div>
<div>&nbsp;&nbsp;<span class="keyword">return</span> <span class="string">"✨ Perfect!"</span>;</div>
<div>}<span class="typing-cursor"></span></div>`,
                output: '✨ Perfect Code!'
            },
            {
                language: 'Python',
                code: `<div><span class="comment"># AI-Powered Data Analysis</span></div>
<div><span class="keyword">def</span> <span class="function">analyze_data</span>(data):</div>
<div>&nbsp;&nbsp;ai = <span class="function">AIAssistant</span>()</div>
<div>&nbsp;&nbsp;insights = ai.<span class="function">analyze</span>(data)</div>
<div>&nbsp;&nbsp;<span class="keyword">return</span> insights.<span class="function">visualize</span>()</div>
<div><span class="typing-cursor"></span></div>`,
                output: '📊 Data insights generated!'
            },
            {
                language: 'Java',
                code: `<div><span class="comment">// AI-Powered API Development</span></div>
<div><span class="keyword">public class</span> <span class="function">AIController</span> {</div>
<div>&nbsp;&nbsp;<span class="keyword">public</span> Response <span class="function">generate</span>() {</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;AI assistant = <span class="keyword">new</span> <span class="function">AI</span>();</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> assistant.<span class="function">createAPI</span>();</div>
<div>&nbsp;&nbsp;}</div>
<div>}<span class="typing-cursor"></span></div>`,
                output: '🚀 API created successfully!'
            },
            {
                language: 'C++',
                code: `<div><span class="comment">// AI-Powered Game Engine</span></div>
<div><span class="keyword">class</span> <span class="function">GameEngine</span> {</div>
<div><span class="keyword">public:</span></div>
<div>&nbsp;&nbsp;<span class="keyword">void</span> <span class="function">initialize</span>() {</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;AI* ai = <span class="keyword">new</span> <span class="function">AI</span>();</div>
<div>&nbsp;&nbsp;&nbsp;&nbsp;ai-><span class="function">generateAssets</span>();</div>
<div>&nbsp;&nbsp;}</div>
<div>};<span class="typing-cursor"></span></div>`,
                output: '🎮 Game assets ready!'
            },
            {
                language: 'Go',
                code: `<div><span class="comment">// AI-Powered Microservice</span></div>
<div><span class="keyword">func</span> <span class="function">Deploy</span>() <span class="keyword">error</span> {</div>
<div>&nbsp;&nbsp;ai := <span class="function">NewAI</span>()</div>
<div>&nbsp;&nbsp;service := ai.<span class="function">CreateService</span>()</div>
<div>&nbsp;&nbsp;<span class="keyword">return</span> service.<span class="function">Deploy</span>()</div>
<div>}<span class="typing-cursor"></span></div>`,
                output: '☁️ Service deployed!'
            }
        ];

        let currentExampleIndex = 0;

        function rotateCodeExample() {
            const preview = document.getElementById('codePreview');
            const badge = document.getElementById('languageBadge');
            const output = document.getElementById('codeOutputDemo');
            
            if (!preview || !badge || !output) return;
            
            // Fade out
            preview.style.opacity = '0';
            
            setTimeout(() => {
                // Update content
                const example = codeExamples[currentExampleIndex];
                preview.innerHTML = example.code;
                badge.textContent = example.language;
                output.textContent = example.output;
                
                // Fade in
                preview.style.opacity = '1';
                
                // Move to next example
                currentExampleIndex = (currentExampleIndex + 1) % codeExamples.length;
            }, 500);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 AI Coder application loaded!');
            showSection('landing');
            
            // Start rotating code examples
            rotateCodeExample();
            setInterval(rotateCodeExample, 4000);
            
            // Initialize AI immediately but quietly
            setTimeout(() => {
                if (window.transformers) {
                    initializeAI().catch(error => {
                        console.log('AI initialization will retry when needed');
                    });
                }
            }, 2000);
        });
    </script>
</body>
</html>